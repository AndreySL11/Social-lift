<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Social Lift Jump — С заставкой и рабочими кнопками</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: linear-gradient(to top, #0b3d91, #1e5fcf);
    font-family: 'Montserrat', sans-serif;
    color: #fff;
    user-select: none;
    overflow: hidden;
  }
  #gameCanvas {
    position: relative;
    z-index: 1;
    pointer-events: none; /* Чтобы клики проходили к кнопкам */
    display: block;
    margin: 0 auto;
    background: transparent;
    border-radius: 16px;
    box-shadow: 0 0 30px #00bfff;
    /* ширина и высота выставляются через JS */
  }
  #ui {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 320px;
    display: flex;
    justify-content: space-between;
    font-size: 20px;
    font-weight: 700;
    z-index: 10;
    pointer-events: none;
  }
  .screen {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 320px;
    max-width: 95vw;
    max-height: 80vh;
    padding: 20px;
    background: rgba(16, 42, 67, 0.95);
    border-radius: 20px;
    box-shadow: 0 0 40px #00bfffcc;
    transform: translate(-50%, -50%);
    text-align: center;
    color: #fff;
    user-select: none;
    z-index: 10;
    display: none;
    overflow-y: auto;
    pointer-events: auto;
  }
  .screen.active {
    display: block;
  }
  button {
    position: relative;
    z-index: 20;
    pointer-events: auto;
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    font-size: 18px;
    padding: 10px 20px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background-color: #00bfff;
    color: #000;
    margin: 8px;
    box-shadow: 0 0 20px #00bfffaa;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #0099cc;
  }
  #splashScreen {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 320px;
    max-width: 95vw;
    max-height: 80vh;
    padding: 20px;
    background: transparent;
    color: #00bfff;
    font-size: 36px;
    font-weight: 900;
    text-align: center;
    transform: translate(-50%, -50%);
    user-select: none;
    z-index: 100;
  }
</style>
</head>
<body>

<div id="splashScreen">Social Lift Game</div>

<canvas id="gameCanvas"></canvas>

<div id="ui">
  <div>Высота: <span id="score">0</span> м</div>
  <div>Монеты SL: <span id="coins">0</span></div>
</div>

<div id="menu" class="screen active">
  <h2>Social Lift Jump</h2>
  <button id="startGameBtn">Начать игру</button>
  <button id="openShopBtn">Магазин</button>
  <button id="openRatingBtn">Рейтинг</button>
</div>

<div id="gameOverScreen" class="screen">
  <h2>Игра окончена</h2>
  <p>Ваш результат: <span id="finalScore">0</span> м</p>
  <p>Монеты: <span id="finalCoins">0</span></p>
  <button id="restartGameBtn">Сыграть еще раз</button>
  <button id="goToMenuBtn1">Меню</button>
</div>

<div id="shopScreen" class="screen">
  <h2>Магазин</h2>
  <div>Монеты: <span id="shopCoins">0</span></div>
  <h3>Скины</h3>
  <div id="skinsList"></div>
  <h3>Усилители</h3>
  <div id="boostersList"></div>
  <button id="closeShopBtn">Назад</button>
</div>

<div id="ratingScreen" class="screen">
  <h2>Рейтинг игроков</h2>
  <div id="ratingList">Рейтинг доступен локально</div>
  <button id="closeRatingBtn">Назад</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Настройка canvas и масштабирование
  const baseWidth = 320;
  const baseHeight = 480;

  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const ui = document.getElementById('ui');
  const splashScreen = document.getElementById('splashScreen');
  const menu = document.getElementById('menu');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const shopScreen = document.getElementById('shopScreen');
  const ratingScreen = document.getElementById('ratingScreen');

  const scoreEl = document.getElementById('score');
  const coinsEl = document.getElementById('coins');
  const startGameBtn = document.getElementById('startGameBtn');
  const openShopBtn = document.getElementById('openShopBtn');
  const openRatingBtn = document.getElementById('openRatingBtn');
  const finalScoreEl = document.getElementById('finalScore');
  const finalCoinsEl = document.getElementById('finalCoins');
  const restartGameBtn = document.getElementById('restartGameBtn');
  const goToMenuBtn1 = document.getElementById('goToMenuBtn1');
  const skinsList = document.getElementById('skinsList');
  const boostersList = document.getElementById('boostersList');
  const shopCoinsEl = document.getElementById('shopCoins');
  const closeShopBtn = document.getElementById('closeShopBtn');
  const ratingList = document.getElementById('ratingList');
  const closeRatingBtn = document.getElementById('closeRatingBtn');

  // Изменение размера и масштаб canvas под экран с сохранением пропорций
  function resizeCanvas() {
    // Размер экрана
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;

    // Вычислим масштаб по ширине и высоте
    const scaleX = windowWidth / baseWidth;
    const scaleY = windowHeight / baseHeight;

    // Выберем минимальный масштаб, чтобы влезло целиком
    const scale = Math.min(scaleX, scaleY);

    // Установим реальный размер canvas
    canvas.width = baseWidth;
    canvas.height = baseHeight;

    // CSS размеры (физический размер на экране)
    canvas.style.width = baseWidth * scale + 'px';
    canvas.style.height = baseHeight * scale + 'px';

    // Центрируем canvas
    canvas.style.display = 'block';
    canvas.style.margin = '0 auto';
  }

  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Переменные игры
  let player = { x: baseWidth/2 - 18, y: baseHeight - 140, width: 36, height: 36, vy: 0, vx: 0, gravity: 0.35, jumpForce: -10, speedX: 0 };
  let platforms = [];
  const platformGap = 50;
  let scrollOffset = 0;
  let gameOver = false;
  let coinsCount = 0;
  let playerCoins = parseInt(localStorage.getItem('playerCoins')) || 0;
  let ownedSkins = JSON.parse(localStorage.getItem('ownedSkins') || '[0]');
  let selectedSkin = parseInt(localStorage.getItem('selectedSkin') || '0');
  let playerBoosts = JSON.parse(localStorage.getItem('playerBoosts') || '{"jump":0,"coin":0}');

  const skins = [
    { id: 0, name: 'Стандартный', price: 0, color: '#00bfff' },
    { id: 1, name: 'Красный', price: 100, color: '#ff4444' },
    { id: 2, name: 'Зелёный', price: 200, color: '#44ff44' },
  ];

  const boosters = [
    { id: 'jump', name: 'Усиление прыжка', price: 150, description: 'Прыжок выше на 2', level: playerBoosts.jump || 0, maxLevel: 3 },
    { id: 'coin', name: 'Увеличение монет', price: 100, description: 'Монет вдвое больше', level: playerBoosts.coin || 0, maxLevel: 3 },
  ];

  // Управление игроком — клавиатура
  let leftPressed = false;
  let rightPressed = false;

  document.addEventListener('keydown', e => {
    if (e.key === 'ArrowLeft' || e.key === 'a') leftPressed = true;
    if (e.key === 'ArrowRight' || e.key === 'd') rightPressed = true;
  });
  document.addEventListener('keyup', e => {
    if (e.key === 'ArrowLeft' || e.key === 'a') leftPressed = false;
    if (e.key === 'ArrowRight' || e.key === 'd') rightPressed = false;
  });

  // Сенсорное управление — свайпы
  let touchStartX = 0;
  let touchStartY = 0;
  let touchEndX = 0;
  let touchEndY = 0;

  canvas.addEventListener('touchstart', (e) => {
    if(e.touches.length === 1){
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    }
  });

  canvas.addEventListener('touchmove', (e) => {
    if(e.touches.length === 1){
      touchEndX = e.touches[0].clientX;
      touchEndY = e.touches[0].clientY;

      const dx = touchEndX - touchStartX;
      const dy = touchEndY - touchStartY;

      if(Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 20){
        // Горизонтальный свайп
        if(dx > 0){
          rightPressed = true;
          leftPressed = false;
        } else {
          leftPressed = true;
          rightPressed = false;
        }
      }
    }
  });

  canvas.addEventListener('touchend', e => {
    leftPressed = false;
    rightPressed = false;
  });

  // Генерация платформ
  function createPlatforms() {
    platforms = [];
    for(let i=0; i<15; i++){
      let px = Math.random() * (baseWidth - 60);
      let py = baseHeight - i*platformGap - 50;
      platforms.push({x: px, y: py, width: 60, height: 12});
    }
  }

  // Обновление игры
  function update() {
    if(gameOver) return;

    // Движение игрока по горизонтали
    if(leftPressed) player.vx = -3;
    else if(rightPressed) player.vx = 3;
    else player.vx = 0;

    player.x += player.vx;

    // Границы экрана
    if(player.x < 0) player.x = 0;
    if(player.x + player.width > baseWidth) player.x = baseWidth - player.width;

    // Гравитация
    player.vy += player.gravity;
    player.y += player.vy;

    // Коллизия с платформами (только если падает)
    platforms.forEach(p => {
      if(player.vy > 0 && player.x + player.width > p.x && player.x < p.x + p.width && player.y + player.height > p.y && player.y + player.height < p.y + p.height){
        player.vy = player.jumpForce - (playerBoosts.jump ? 2 * playerBoosts.jump : 0);
        coinsCount++;
        scoreEl.textContent = Math.floor(scrollOffset / 10 + coinsCount);
      }
    });

    // Сдвиг платформ вниз если игрок прыгает выше середины экрана
    if(player.y < baseHeight / 2){
      let diff = (baseHeight / 2) - player.y;
      player.y = baseHeight / 2;
      scrollOffset += diff;
      platforms.forEach(p => p.y += diff);

      // Удаляем платформы, которые ушли вниз, создаём новые сверху
      platforms = platforms.filter(p => p.y < baseHeight);
      while(platforms.length < 15){
        let px = Math.random() * (baseWidth - 60);
        let py = platforms[0].y - platformGap;
        platforms.unshift({x: px, y: py, width: 60, height: 12});
      }
    }

    // Проверка падения
    if(player.y > baseHeight) {
      endGame();
    }

    coinsEl.textContent = playerCoins + coinsCount;

  }

  // Отрисовка
  function draw() {
    ctx.clearRect(0, 0, baseWidth, baseHeight);

    // Фон с градиентом
    const gradient = ctx.createLinearGradient(0, 0, 0, baseHeight);
    gradient.addColorStop(0, '#0b3d91');
    gradient.addColorStop(1, '#1e5fcf');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, baseWidth, baseHeight);

    // Платформы
    platforms.forEach(p => {
      ctx.fillStyle = '#00bfff';
      ctx.fillRect(p.x, p.y, p.width, p.height);
    });

    // Игрок — прямоугольник с цветом скина
    const skin = skins[selectedSkin] || skins[0];
    ctx.fillStyle = skin.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Тени
    ctx.shadowColor = 'rgba(0, 191, 255, 0.7)';
    ctx.shadowBlur = 10;
    ctx.fillRect(player.x, player.y, player.width, player.height);
    ctx.shadowBlur = 0;
  }

  // Игровой цикл
  function gameLoop() {
    update();
    draw();
    if(!gameOver) requestAnimationFrame(gameLoop);
  }

  // Начать игру
  function startGame() {
    gameOver = false;
    player.x = baseWidth/2 - 18;
    player.y = baseHeight - 140;
    player.vx = 0;
    player.vy = 0;
    scrollOffset = 0;
    coinsCount = 0;
    scoreEl.textContent = '0';
    createPlatforms();
    menu.classList.remove('active');
    gameOverScreen.classList.remove('active');
    shopScreen.classList.remove('active');
    ratingScreen.classList.remove('active');
    ui.style.display = 'flex';
    splashScreen.style.display = 'none';
    gameLoop();
  }

  // Конец игры
  function endGame() {
    gameOver = true;
    playerCoins += coinsCount;
    localStorage.setItem('playerCoins', playerCoins);
    finalScoreEl.textContent = Math.floor(scrollOffset / 10 + coinsCount);
    finalCoinsEl.textContent = playerCoins;
    ui.style.display = 'none';
    gameOverScreen.classList.add('active');
  }

  // Магазин
  function openShop() {
    shopScreen.classList.add('active');
    menu.classList.remove('active');
    gameOverScreen.classList.remove('active');
    ratingScreen.classList.remove('active');
    ui.style.display = 'none';
    shopCoinsEl.textContent = playerCoins;
    updateShop();
  }

  function updateShop() {
    // Скины
    skinsList.innerHTML = '';
    skins.forEach(skin => {
      let owned = ownedSkins.includes(skin.id);
      let btn = document.createElement('button');
      btn.textContent = owned ? (selectedSkin === skin.id ? 'Выбран' : 'Выбрать') : `Купить за ${skin.price}`;
      btn.disabled = (!owned && playerCoins < skin.price);
      btn.style.backgroundColor = skin.color;
      btn.style.color = '#000';
      btn.style.margin = '4px';
      btn.style.width = '100px';

      btn.onclick = () => {
        if(!owned){
          if(playerCoins >= skin.price){
            playerCoins -= skin.price;
            ownedSkins.push(skin.id);
            localStorage.setItem('playerCoins', playerCoins);
            localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
            selectedSkin = skin.id;
            localStorage.setItem('selectedSkin', selectedSkin);
            updateShop();
          }
        } else {
          selectedSkin = skin.id;
          localStorage.setItem('selectedSkin', selectedSkin);
          updateShop();
        }
        shopCoinsEl.textContent = playerCoins;
      };

      skinsList.appendChild(btn);
    });

    // Усилители
    boostersList.innerHTML = '';
    boosters.forEach(boost => {
      let level = playerBoosts[boost.id] || 0;
      let btn = document.createElement('button');
      btn.textContent = level >= boost.maxLevel ? 'Максимум' : `Купить ${boost.name} за ${boost.price}`;
      btn.disabled = (playerCoins < boost.price || level >= boost.maxLevel);
      btn.style.margin = '4px';
      btn.style.width = '200px';

      btn.onclick = () => {
        if(playerCoins >= boost.price && level < boost.maxLevel){
          playerCoins -= boost.price;
          playerBoosts[boost.id] = (playerBoosts[boost.id] || 0) + 1;
          localStorage.setItem('playerCoins', playerCoins);
          localStorage.setItem('playerBoosts', JSON.stringify(playerBoosts));
          updateShop();
          shopCoinsEl.textContent = playerCoins;
        }
      };

      boostersList.appendChild(btn);
    });
  }

  // Рейтинг (локальный, простой)
  function openRating() {
    ratingScreen.classList.add('active');
    menu.classList.remove('active');
    gameOverScreen.classList.remove('active');
    shopScreen.classList.remove('active');
    ui.style.display = 'none';

    // Можно потом заменить на реальный онлайн рейтинг
    ratingList.innerHTML = `<p>Рейтинг пока недоступен</p>`;
  }

  // Кнопки управления экранами
  startGameBtn.onclick = startGame;
  openShopBtn.onclick = openShop;
  openRatingBtn.onclick = openRating;
  closeShopBtn.onclick = () => {
    shopScreen.classList.remove('active');
    menu.classList.add('active');
  };
  closeRatingBtn.onclick = () => {
    ratingScreen.classList.remove('active');
    menu.classList.add('active');
  };
  restartGameBtn.onclick = startGame;
  goToMenuBtn1.onclick = () => {
    gameOverScreen.classList.remove('active');
    menu.classList.add('active');
  };

  // Скрыть заставку через 2 секунды
  setTimeout(() => {
    splashScreen.style.display = 'none';
  }, 2000);
});
</script>

</body>
</html>

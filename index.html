<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Social Lift Jump</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
    *{user-select:none; margin:0; padding:0;}
    body {
      overflow:hidden; background:black; font-family:'Montserrat',sans-serif;
    }
    #gameCanvas {
      background:#102a43;
      display:block;
      margin:20px auto;
      border-radius:8px;
      box-shadow:0 0 20px rgba(255,255,255,0.2);
    }
    #ui {
      position:fixed; top:10px; left:50%; transform:translateX(-50%);
      display:flex; justify-content:space-between;
      width:360px; color:white; font-size:18px; font-weight:600;
    }
    button, .modal button {
      background:#00bcd4; border:none; color:white; padding:8px 16px;
      border-radius:6px; cursor:pointer; margin:4px;
    }
    .modal {
      position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:black; border:2px solid #00bcd4; padding:20px;
      display:none; color:white; max-width:90%; max-height:90%; overflow:auto;
      border-radius:8px;
    }
    .modal h2{margin-bottom:10px;}
    .boost {position:absolute; font-size:20px; font-weight:bold;}
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="360" height="600"></canvas>
  <div id="ui">
    <div>‚õèÔ∏è: <span id="score">0</span></div>
    <div>‚ö°: <span id="coins">0</span></div>
    <button id="leaderBtn">üèÜ</button>
    <button id="shopBtn">üõí</button>
    <button id="inviteBtn">üë•</button>
  </div>

  <div id="leaderModal" class="modal">
    <h2>–†–µ–π—Ç–∏–Ω–≥ –ª–∏–¥–µ—Ä–æ–≤</h2>
    <div id="leaderList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <button onclick="closeModal('leaderModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <div id="shopModal" class="modal">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div>–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –±–µ–ª—ã–º ‚Äî 50 ‚ö° <button onclick="buyColor('#ffffff')">–ö—É–ø–∏—Ç—å</button></div>
    <div>–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≥–æ–ª—É–±—ã–º ‚Äî 50 ‚ö° <button onclick="buyColor('#00e5ff')">–ö—É–ø–∏—Ç—å</button></div>
    <button onclick="closeModal('shopModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <canvas id="inviteCanvas" style="display:none;"></canvas>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const W=canvas.width, H=canvas.height;
    const scoreEl = document.getElementById('score');
    const coinsEl = document.getElementById('coins');

    let score = 0, coins = 0, bestScore = 0;
    let scroll=0, gameOver=false;
    let boosters = [];

    const player = {x:W/2,y:H-100,w:30,h:40,vx:0,vy:0,grav:0.3,jump:-8,
                    color:'#FFD700', shield:false, double:false, magnet:false};

    class Platform {
      constructor(x,y,w,h,type='static'){
        this.x=x; this.y=y; this.w=w; this.h=h; this.type=type;
        this.mr=60; this.dir=1; this.speed=1;
        this.boost = Math.random()<0.2 ? ['double','magnet','shield'][Math.floor(Math.random()*3)] : null;
        this.collected=false;
      }
      update(){
        if(this.type==='moving'){this.x+=this.speed*this.dir;
          if(this.x<0||this.x+this.w>W) this.dir*=-1;}
      }
      draw(){
        ctx.fillStyle='#00bcd4'; ctx.fillRect(this.x,this.y,this.w,this.h);
        if(this.boost && !this.collected){
          ctx.fillStyle='white';ctx.font='20px Montserrat';
          ctx.fillText(this.boost[0].toUpperCase(), this.x+this.w/2,this.y-5);
        }
      }
    }

    let plats=[]; const maxPlat=12, gap=50;

    function initPlatforms(){
      plats=[new Platform(W/2-60,H-30,120,15)];
      let y=H-100;
      while(plats.length<maxPlat){
        let c = Math.random()<0.6?2:1;
        for(let i=0;i<c;i++){
          let x=Math.random()*(W-60), type=Math.random()<0.3?'moving':'static';
          if(!plats.some(p=>Math.abs(p.y-y)<10&&Math.abs(p.x-x)<60))
            plats.push(new Platform(x,y,60,10,type));
        }
        y-=gap+Math.random()*15;
      }
    }

    let moveDir=0;
    addEventListener('touchstart',e=>{moveDir=e.touches[0].clientX<W/2?-1:1;});
    addEventListener('touchend',e=>{moveDir=0;});
    addEventListener('mousedown',e=>{moveDir=e.clientX<W/2?-1:1;});
    addEventListener('mouseup',e=>{moveDir=0;});

    document.getElementById('leaderBtn').onclick = async()=>{
      openModal('leaderModal');
      let res = await fetch('https://your-server.com/api/leaderboard');
      let data = await res.json();
      document.getElementById('leaderList').innerHTML = data.map(u=>`${u.username}: ${u.score}`).join('<br>');
    };
    document.getElementById('shopBtn').onclick=()=>openModal('shopModal');
    document.getElementById('inviteBtn').onclick=()=>inviteFriend();

    function buyColor(c){
      if(coins<50)return alert('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç');
      coins-=50; player.color=c; coinsEl.textContent=coins;
    }

    function openModal(id){document.getElementById(id).style.display='block';}
    function closeModal(id){document.getElementById(id).style.display='none';}

    async function inviteFriend(){
      // –ü–æ–ª—É—á–∞–µ–º QR —Å —Å–µ—Ä–≤–µ—Ä–∞ (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –≤–∞—à–µ–º –±—ç–∫–µ)
      let res = await fetch('https://your-server.com/api/invite_qr');
      let blob = await res.blob(), img=new Image();
      img.onload=()=>{const ic=document.getElementById('inviteCanvas');
        ic.width=200; ic.height=200; ic.style.display='block';
        ic.getContext('2d').drawImage(img,0,0);}
      img.src=URL.createObjectURL(blob);
    }

    function sendScore(){
      const data = {
        username: window.Telegram.WebApp.initDataUnsafe.user.username||'anon',
        score, coins
      };
      fetch('https://your-server.com/api/score',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
    }

    function update(){
      if(gameOver) return;
      player.vx=moveDir*3; player.x+=player.vx;
      if(player.x+player.w<0)player.x=W;
      if(player.x>W)player.x=-player.w;
      player.vy+=player.grav; player.y+=player.vy;

      plats.forEach(p=>{
        p.update();
        if(player.vy>0 && player.x+player.w>p.x && player.x<p.x+p.w
          && player.y+player.h>p.y && player.y+player.h< p.y+p.h+player.vy){
            player.vy=player.jump;
            if(p.boost && !p.collected){
              player[p.boost]=true;
              p.collected=true;
              boosters.push({type:p.boost, t:performance.now()});
            }
        }
      });

      if(player.y < H*0.3){
        let d = H*0.3 - player.y; player.y = H*0.3;
        scroll+=d; score=scroll|0; scoreEl.textContent=score;
        plats.forEach(p=>p.y+=d);
      }

      plats = plats.filter(p=>p.y<H+20);
      while(plats.length<maxPlat){
        let lp=plats[plats.length-1];
        let x=Math.random()*(W-60), type=Math.random()<0.3?'moving':'static';
        let np=new Platform(x, lp.y-gap-Math.random()*15,60,10,type);
        plats.push(np);
      }

      if(player.y>H){gameOver=true; restart.style.display='block'; sendScore();}
    }

    function draw(){
      // —Ñ–æ–Ω –¥–µ–Ω—å/–Ω–æ—á—å
      let t = Math.min(score/1000,1);
      let r=20+(135-20)*t, g=20+(206-20)*t, b=50+(235-50)*t;
      ctx.fillStyle=`rgb(${r|0},${g|0},${b|0})`;
      ctx.fillRect(0,0,W,H);

      plats.forEach(p=>p.draw());
      ctx.fillStyle=player.color;
      ctx.fillRect(player.x,player.y,player.w,player.h);
      ctx.fillStyle='white';
      ctx.font='14px Montserrat'; ctx.textAlign='center'; ctx.fillText('SL', player.x+player.w/2,player.y+player.h/2);
    }

    function loop(){
      update(); draw();
      if(!gameOver)requestAnimationFrame(loop);
    }

    const restart = document.getElementById('restartBtn');
    restart.onclick=()=>{
      scroll=0; score=0; coins=0;scoreEl.textContent='0';coinsEl.textContent='0';
      player.x=W/2; player.y=H-100; player.vy=0;
      gameOver=false; restart.style.display='none';
      booster=[]; initPlatforms(); loop();
    };

    initPlatforms(); loop();
  </script>
</body>
</html>

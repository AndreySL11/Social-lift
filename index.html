<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Social Lift Jump — Social Lift</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: #000;
    font-family: 'Montserrat', sans-serif;
    overflow: hidden;
    color: #fff;
    user-select: none;
  }
  #gameCanvas {
    display: block;
    margin: 0 auto;
    background: #000;
    border-radius: 16px;
    box-shadow: 0 0 30px #00bfff;
    touch-action: none;
    max-width: 100vw;
    max-height: 80vh;
    position: relative;
    z-index: 1;
  }
  #ui {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 320px;
    display: flex;
    justify-content: space-between;
    font-size: 20px;
    font-weight: 700;
    z-index: 1000;
    pointer-events: none;
  }
  .screen {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 320px;
    max-width: 95vw;
    max-height: 80vh;
    padding: 20px;
    background: rgba(0,0,0,0.95);
    border-radius: 20px;
    box-shadow: 0 0 40px #00bfffcc;
    transform: translate(-50%, -50%);
    text-align: center;
    color: #fff;
    user-select: none;
    z-index: 1050;
    display: none;
    overflow-y: auto;
    pointer-events: auto;
  }
  .screen.active {
    display: block;
  }
  button {
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    font-size: 18px;
    padding: 10px 20px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background-color: #00bfff;
    color: #000;
    margin: 8px;
    box-shadow: 0 0 20px #00bfffaa;
    user-select: none;
    pointer-events: auto;
    transition: background-color 0.3s ease;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    z-index: 1100;
  }
  button:hover {
    background-color: #0099cc;
  }
  .shop-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 8px 0;
    border-bottom: 1px solid #00bfff44;
    padding-bottom: 8px;
  }
  .skin-preview {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    margin-right: 12px;
    background-size: cover;
    background-position: center;
    border: 2px solid #00BFFF;
    flex-shrink: 0;
  }
  .boost-desc {
    font-size: 13px;
    color: #00BFFF;
    margin-left: 8px;
  }
  #ratingList {
    max-height: 200px;
    overflow-y: auto;
    text-align: left;
    margin-top: 10px;
    font-size: 16px;
  }
</style>
</head>
<body>

<canvas id="gameCanvas" width="320" height="480"></canvas>

<div id="ui">
  <div>Высота: <span id="score">0</span> м</div>
  <div>Монеты SL: <span id="coins">0</span></div>
</div>

<div id="menu" class="screen active">
  <h2>Social Lift Jump</h2>
  <button id="startGameBtn">Начать игру</button>
  <button id="openShopBtn">Магазин</button>
  <button id="openRatingBtn">Рейтинг</button>
</div>

<div id="gameOverScreen" class="screen">
  <h2>Игра окончена</h2>
  <p>Ваш результат: <span id="finalScore">0</span> м</p>
  <p>Монеты: <span id="finalCoins">0</span></p>
  <button id="restartGameBtn">Начать заново</button>
  <button id="goToMenuBtn1">В меню</button>
</div>

<div id="shopScreen" class="screen">
  <h2>Магазин</h2>
  <div>Монеты: <span id="shopCoins">0</span></div>
  <h3>Скины</h3>
  <div id="skinsList"></div>
  <h3>Усилители</h3>
  <div id="boostersList"></div>
  <button id="closeShopBtn">Назад</button>
</div>

<div id="ratingScreen" class="screen">
  <h2>Рейтинг игроков</h2>
  <div id="ratingList">Рейтинг доступен локально</div>
  <button id="closeRatingBtn">Назад</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;

  const scoreEl = document.getElementById('score');
  const coinsEl = document.getElementById('coins');
  const menu = document.getElementById('menu');
  const startGameBtn = document.getElementById('startGameBtn');
  const openShopBtn = document.getElementById('openShopBtn');
  const openRatingBtn = document.getElementById('openRatingBtn');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const finalScoreEl = document.getElementById('finalScore');
  const finalCoinsEl = document.getElementById('finalCoins');
  const restartGameBtn = document.getElementById('restartGameBtn');
  const goToMenuBtn1 = document.getElementById('goToMenuBtn1');
  const shopScreen = document.getElementById('shopScreen');
  const skinsList = document.getElementById('skinsList');
  const boostersList = document.getElementById('boostersList');
  const shopCoinsEl = document.getElementById('shopCoins');
  const closeShopBtn = document.getElementById('closeShopBtn');
  const ratingScreen = document.getElementById('ratingScreen');
  const ratingList = document.getElementById('ratingList');
  const closeRatingBtn = document.getElementById('closeRatingBtn');

  // --- Переменные игры ---
  let player = { x: width/2 - 18, y: height - 140, width: 36, height: 36, vy: 0, vx: 0, gravity: 0.35, jumpForce: -10 };
  let platforms = [];
  const platformGap = 50;
  let scrollOffset = 0;
  let gameOver = false;
  let coinsCount = 0;
  let playerCoins = parseInt(localStorage.getItem('playerCoins')) || 0;
  let ownedSkins = JSON.parse(localStorage.getItem('ownedSkins') || '[0]');
  let selectedSkin = parseInt(localStorage.getItem('selectedSkin') || '0');
  let playerBoosts = JSON.parse(localStorage.getItem('playerBoosts') || '{"jump":0,"coin":0}');

  // --- Скины ---
  const skins = [
    { id: 0, name: 'Голубой', price: 0, color: '#00BFFF', img: null },
    { id: 1, name: 'Белый', price: 100, color: '#FFFFFF', img: null },
    { id: 2, name: 'Черный', price: 150, color: '#000000', img: null },
    { id: 3, name: 'Красный', price: 200, color: '#FF0000', img: null },
    { id: 4, name: 'Зелёный', price: 250, color: '#00FF00', img: null },
    { id: 5, name: 'Оранжевый', price: 300, color: '#FFA500', img: null },
    { id: 6, name: 'Розовый', price: 350, color: '#FFC0CB', img: null },
    { id: 7, name: 'Фиолетовый', price: 400, color: '#800080', img: null },
    { id: 8, name: 'Утка', price: 500, color: '#00BFFF', img: 'https://i.imgur.com/7yUvePI.png' }, // пример с картинкой
  ];

  // --- Усилители ---
  const boosters = [
    { id: 'jump', name: 'Сила прыжка +1', price: 200, desc: 'Увеличивает высоту прыжка', amount: 0 },
    { id: 'coin', name: 'Монеты x2', price: 300, desc: 'Удваивает количество собираемых монет', amount: 0 },
  ];

  // --- Инициализация ---
  function initPlatforms() {
    platforms = [];
    let y = height - 20;
    for (let i = 0; i < 20; i++) {
      platforms.push({
        x: Math.random() * (width - 80),
        y: y,
        width: 80,
        height: 12,
        type: 'normal',
      });
      y -= platformGap;
    }
  }

  function drawPlayer() {
    ctx.fillStyle = skins[selectedSkin]?.color || '#00BFFF';
    if(skins[selectedSkin]?.img){
      let img = new Image();
      img.src = skins[selectedSkin].img;
      ctx.drawImage(img, player.x, player.y, player.width, player.height);
    } else {
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }
  }

  function drawPlatforms() {
    ctx.fillStyle = '#00bfff';
    platforms.forEach(p => {
      ctx.fillRect(p.x, p.y, p.width, p.height);
    });
  }

  function drawCoins() {
    ctx.fillStyle = '#FFD700';
    platforms.forEach(p => {
      if(p.coin) {
        ctx.beginPath();
        ctx.arc(p.x + p.width/2, p.y - 10, 6, 0, Math.PI*2);
        ctx.fill();
      }
    });
  }

  function update() {
    if(gameOver) return;
    // Обновляем игрока
    player.vy += player.gravity;
    player.y += player.vy;
    player.x += player.vx;

    if(player.x < 0) player.x = 0;
    if(player.x + player.width > width) player.x = width - player.width;

    // Проверяем платформы
    platforms.forEach(p => {
      if(
        player.vy > 0 &&
        player.x + player.width > p.x &&
        player.x < p.x + p.width &&
        player.y + player.height > p.y &&
        player.y + player.height < p.y + p.height + player.vy
      ) {
        player.y = p.y - player.height;
        player.vy = player.jumpForce - (playerBoosts.jump || 0);
      }
      // Проверка на монеты
      if(p.coin && player.x + player.width > p.x && player.x < p.x + p.width && player.y + player.height > p.y - 20 && player.y < p.y) {
        coinsCount += 1 * ((playerBoosts.coin && playerBoosts.coin > 0) ? 2 : 1);
        p.coin = false;
      }
    });

    // Скроллим платформы и игрока вверх, если прыгнули выше середины
    if(player.y < height/2) {
      const diff = height/2 - player.y;
      player.y = height/2;
      platforms.forEach(p => {
        p.y += diff;
        if(p.y > height) {
          p.y = 0;
          p.x = Math.random() * (width - 80);
          p.coin = Math.random() < 0.3; // вероятность монеты
        }
      });
      scrollOffset += diff;
    }

    // Проверяем падение ниже экрана - конец игры
    if(player.y > height) {
      endGame();
    }

    scoreEl.textContent = Math.floor(scrollOffset);
    coinsEl.textContent = playerCoins + coinsCount;
  }

  function draw() {
    ctx.clearRect(0, 0, width, height);
    drawPlatforms();
    drawCoins();
    drawPlayer();
  }

  function gameLoop() {
    update();
    draw();
    if(!gameOver) requestAnimationFrame(gameLoop);
  }

  // Управление
  window.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft' || e.key === 'a') player.vx = -5;
    if(e.key === 'ArrowRight' || e.key === 'd') player.vx = 5;
  });
  window.addEventListener('keyup', e => {
    if(e.key === 'ArrowLeft' || e.key === 'a') player.vx = 0;
    if(e.key === 'ArrowRight' || e.key === 'd') player.vx = 0;
  });

  // Мобильное управление
  let touchStartX = null;
  canvas.addEventListener('touchstart', e => {
    touchStartX = e.touches[0].clientX;
  });
  canvas.addEventListener('touchmove', e => {
    if(touchStartX === null) return;
    let dx = e.touches[0].clientX - touchStartX;
    if(dx > 10) player.vx = 5;
    else if(dx < -10) player.vx = -5;
    else player.vx = 0;
  });
  canvas.addEventListener('touchend', e => {
    player.vx = 0;
    touchStartX = null;
  });

  // --- Меню ---
  function showScreen(screen) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    screen.classList.add('active');
  }

  function startGame() {
    gameOver = false;
    scrollOffset = 0;
    coinsCount = 0;
    player.x = width/2 - player.width/2;
    player.y = height - 140;
    player.vx = 0;
    player.vy = 0;
    initPlatforms();
    // Добавляем монеты случайно на платформах
    platforms.forEach(p => { p.coin = Math.random() < 0.3; });
    showScreen(null);
    gameLoop();
  }

  function endGame() {
    gameOver = true;
    playerCoins += coinsCount;
    localStorage.setItem('playerCoins', playerCoins);
    finalScoreEl.textContent = Math.floor(scrollOffset);
    finalCoinsEl.textContent = coinsCount;
    shopCoinsEl.textContent = playerCoins;
    showScreen(gameOverScreen);
  }

  // --- Магазин ---
  function renderShop() {
    shopCoinsEl.textContent = playerCoins;
    // Скины
    skinsList.innerHTML = '';
    skins.forEach(skin => {
      const div = document.createElement('div');
      div.className = 'shop-item';

      const preview = document.createElement('div');
      preview.className = 'skin-preview';
      if(skin.img){
        preview.style.backgroundImage = `url(${skin.img})`;
      } else {
        preview.style.backgroundColor = skin.color;
      }
      div.appendChild(preview);

      const name = document.createElement('div');
      name.textContent = skin.name;
      div.appendChild(name);

      const price = document.createElement('div');
      if(ownedSkins.includes(skin.id)){
        price.textContent = (selectedSkin === skin.id) ? 'Выбрано' : 'Куплено';
      } else {
        price.textContent = skin.price + ' SL';
      }
      div.appendChild(price);

      const btn = document.createElement('button');
      if(ownedSkins.includes(skin.id)){
        if(selectedSkin === skin.id){
          btn.textContent = 'Текущий';
          btn.disabled = true;
        } else {
          btn.textContent = 'Выбрать';
          btn.onclick = () => {
            selectedSkin = skin.id;
            localStorage.setItem('selectedSkin', selectedSkin);
            renderShop();
          };
        }
      } else {
        btn.textContent = 'Купить';
        btn.onclick = () => {
          if(playerCoins >= skin.price){
            playerCoins -= skin.price;
            localStorage.setItem('playerCoins', playerCoins);
            ownedSkins.push(skin.id);
            localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
            selectedSkin = skin.id;
            localStorage.setItem('selectedSkin', selectedSkin);
            renderShop();
          } else {
            alert('Недостаточно монет');
          }
        };
      }
      div.appendChild(btn);

      skinsList.appendChild(div);
    });

    // Усилители
    boostersList.innerHTML = '';
    boosters.forEach(boost => {
      const div = document.createElement('div');
      div.className = 'shop-item';

      const name = document.createElement('div');
      name.textContent = boost.name;
      div.appendChild(name);

      const desc = document.createElement('div');
      desc.className = 'boost-desc';
      desc.textContent = boost.desc + ' (У вас: ' + (playerBoosts[boost.id] || 0) + ')';
      div.appendChild(desc);

      const btn = document.createElement('button');
      btn.textContent = 'Купить за ' + boost.price + ' SL';
      btn.onclick = () => {
        if(playerCoins >= boost.price){
          playerCoins -= boost.price;
          playerBoosts[boost.id] = (playerBoosts[boost.id] || 0) + 1;
          localStorage.setItem('playerCoins', playerCoins);
          localStorage.setItem('playerBoosts', JSON.stringify(playerBoosts));
          renderShop();
        } else {
          alert('Недостаточно монет');
        }
      };
      div.appendChild(btn);

      boostersList.appendChild(div);
    });
  }

  // --- Рейтинг ---
  function renderRating() {
    let listHtml = '';
    let dummyPlayers = [
      {name: 'Игрок1', score: 800},
      {name: 'Игрок2', score: 650},
      {name: 'Игрок3', score: 500},
      {name: 'Вы', score: Math.floor(scrollOffset)},
    ];
    dummyPlayers.sort((a,b) => b.score - a.score);
    dummyPlayers.forEach((p,i) => {
      listHtml += `<div>${i+1}. ${p.name}: ${p.score} м</div>`;
    });
    ratingList.innerHTML = listHtml;
  }

  // --- События кнопок ---
  startGameBtn.onclick = () => {
    startGame();
  };
  restartGameBtn.onclick = () => {
    startGame();
  };
  goToMenuBtn1.onclick = () => {
    showScreen(menu);
  };
  openShopBtn.onclick = () => {
    renderShop();
    showScreen(shopScreen);
  };
  closeShopBtn.onclick = () => {
    showScreen(menu);
  };
  openRatingBtn.onclick = () => {
    renderRating();
    showScreen(ratingScreen);
  };
  closeRatingBtn.onclick = () => {
    showScreen(menu);
  };

  // Начальный экран виден, игра остановлена
  showScreen(menu);
});
</script>

</body>
</html>



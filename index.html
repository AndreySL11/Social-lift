<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Social Lift Jump</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
    body {
      margin: 0; overflow: hidden;
      background: #000;
      font-family: 'Montserrat', sans-serif;
      color: #fff;
      user-select: none;
    }
    #overlay {
      position: absolute; width:100%; height:100%;
      background: linear-gradient(135deg, #0D1B2A, #1B263B);
      display:flex; align-items:center; justify-content:center;
      flex-direction:column;
      z-index:2;
    }
    #overlay h1 {
      font-size: 48px; margin-bottom: 20px;
      color: #69B3FF;
      text-shadow: 2px 2px #000;
    }
    #startBtn {
      padding: 15px 30px;
      font-size: 24px;
      background: #69B3FF;
      color: #000;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 10px #fff;
    }
    #startBtn:hover {
      background: #5AA7DB;
    }
    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: #0D1B2A;
    }
    #ui {
      position: absolute; top:10px; left:50%;
      transform: translateX(-50%);
      display:flex; gap:20px;
      font-size:18px;
      color:#69B3FF;
      z-index:1;
    }
    #leaderboard {
      position:absolute; bottom:20px; left:50%;
      transform: translateX(-50%);
      width:300px;
      background: rgba(20,30,40,0.8);
      padding:10px; border-radius:8px;
      text-align:center;
      font-size:16px;
      z-index:1;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <h1>Social Lift</h1>
    <button id="startBtn">Начать игру</button>
  </div>
  <canvas id="gameCanvas" width="360" height="640"></canvas>
  <div id="ui">
    <div>Высота: <span id="score">0</span> м</div>
    <div>Монеты SL: <span id="coins">0</span></div>
  </div>
  <div id="leaderboard">
    <strong>Топ-5 игроков</strong>
    <ol id="boardList">
      <li>—</li><li>—</li><li>—</li><li>—</li><li>—</li>
    </ol>
  </div>

  <script>
    (() => {
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');
      const w = canvas.width, h = canvas.height;
      const overlay = document.getElementById('overlay');
      const startBtn = document.getElementById('startBtn');
      const scoreEl = document.getElementById('score');
      const coinsEl = document.getElementById('coins');
      const boardList = document.getElementById('boardList');

      // Игровые сущности
      let player, platforms, scroll, coins, gameOver;
      const maxP = 12, gap = 50;

      class PF {
        constructor(x,y,wid,type='static'){
          this.x=x; this.y=y; this.w=wid; this.h=12;
          this.type=type; this.baseX=x; this.dir=1;
          this.coin = Math.random()<0.35; this.coined=false;
        }
        upd(){
          if(this.type==='moving'){
            this.x += this.dir*1.2;
            if(this.x > this.baseX+40 || this.x<this.baseX-40) this.dir*=-1;
          }
        }
        draw(){
          ctx.fillStyle='#69B3FF'; ctx.fillRect(this.x,this.y,this.w,this.h);
          ctx.strokeStyle='#fff'; ctx.strokeRect(this.x,this.y,this.w,this.h);
          if(this.coin && !this.coined){
            const cx=this.x+this.w/2, cy=this.y-10;
            ctx.fillStyle='#FFD700'; ctx.beginPath();
            ctx.arc(cx,cy,8,0,2*Math.PI); ctx.fill();
            ctx.fillStyle='#000'; ctx.font='10px Montserrat'; ctx.fillText('SL',cx,cy+1);
          }
        }
      }

      function initGame(){
        player = { x: w/2-15, y: h-120, w:30, h:40, vy:0 };
        scroll=0; coins=0; gameOver=false;
        platforms = [];
        platforms.push(new PF(w/2-50,h-30,100,'static'));
        let y=h-100;
        while(platforms.length<maxP){
          const cnt=(Math.random()<.6?2:1);
          for(let i=0;i<cnt;i++){
            const pl=new PF(Math.random()*(w-60),y,60,Math.random()<.3?'moving':'static');
            if(!platforms.some(o=>Math.abs(o.y-y)<10 && Math.abs(o.x-pl.x)<60)) platforms.push(pl);
          }
          y-=gap+Math.random()*20;
        }
        scoreEl.textContent='0'; coinsEl.textContent='0';
      }

      function update(){
        if(gameOver) return;
        player.vy += 0.35;
        player.y += player.vy;
        platforms.forEach(p => {
          p.upd();
          if(player.vy>0
            && player.x+player.w>p.x
            && player.x<p.x+p.w
            && player.y+player.h > p.y
            && player.y+player.h < p.y+p.h+player.vy
          ){
            player.vy = -8;
            if(p.coin && !p.coined){
              p.coined=true;
              coins++; coinsEl.textContent=coins;
            }
            if(p.type==='moving') player.x += p.dir*1.2;
          }
        });
        if(player.y < h/3){
          const dy = h/3 - player.y;
          player.y = h/3;
          platforms.forEach(p=>p.y+=dy);
          scroll += dy;
          scoreEl.textContent = Math.floor(scroll);
        }
        platforms = platforms.filter(p=>p.y<h+20);
        while(platforms.length<maxP){
          const lp=platforms[platforms.length-1];
          const newP=new PF(Math.random()*(w-60),lp.y-gap-Math.random()*20,60,Math.random()<.3?'moving':'static');
          platforms.push(newP);
        }
        if(player.y > h){ gameOver=true; onGameEnd(); }
      }

      function draw(){
        ctx.clearRect(0,0,w,h);
        platforms.forEach(p=>p.draw());
        ctx.fillStyle='#FFD700';
        ctx.fillRect(player.x,player.y,player.w,player.h);
        ctx.fillStyle='#000';
        ctx.font='bold 14px Montserrat';
        ctx.fillText('SL',player.x+player.w/2-10,player.y+player.h/2+3);
      }

      function loop(){ update(); draw(); if(!gameOver) requestAnimationFrame(loop); }

      function onGameEnd(){
        const nick = window.Telegram?.WebApp?.initDataUnsafe?.user?.username || 'Player';
        const score = Math.floor(scroll);
        const rec = JSON.parse(localStorage.getItem('slboard')||'[]');
        rec.push({nick,score}); rec.sort((a,b)=>b.score-a.score);
        localStorage.setItem('slboard', JSON.stringify(rec.slice(0,5)));
        showBoard();
      }

      function showBoard(){
        const rec = JSON.parse(localStorage.getItem('slboard')||'[]');
        boardList.innerHTML = rec.slice(0,5).map(e=>`<li>${e.nick}: ${e.score} м</li>`).join('');
      }

      startBtn.onclick = ()=>{
        overlay.style.display='none';
        initGame(); showBoard(); loop();
      };

      // Поддержка касаний и кликов
      let dir = 0;
      window.addEventListener('mousedown', e => {dir = (e.clientX < w/2 ? -1:1);});
      window.addEventListener('mouseup', ()=> dir=0);
      window.addEventListener('touchstart', e=>dir = (e.touches[0].clientX < w/2 ? -1:1));
      window.addEventListener('touchend', ()=>dir=0);

      // Движение игрока
      setInterval(()=>{
        if(!gameOver) player.x += dir*3;
        if(player.x+player.w<0) player.x=w;
        if(player.x>w) player.x=-player.w;
      },16);

      // При загрузке
      showBoard();
    })();
  </script>
</body>
</html>

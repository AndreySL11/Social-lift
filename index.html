проверь код, все ли верно? 

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Social Lift Jump</title>
<style>
  html, body {
    margin:0; padding:0; overflow:hidden; background:#111;
    font-family: 'Arial Black', Arial, sans-serif;
    color:#fff;
    -webkit-tap-highlight-color: transparent;
    -webkit-user-select:none;
    -moz-user-select:none;
    -ms-user-select:none;
    user-select:none;
  }
  canvas { background:#111; display:block; margin:0 auto; touch-action:none; }
  #ui {
    position: fixed;
    top: 10px; left: 50%; transform: translateX(-50%);
    width: 320px;
    display: flex;
    justify-content: space-between;
    pointer-events:none;
    user-select:none;
    font-weight: bold;
    font-size: 18px;
    text-shadow: 0 0 5px #00ffff;
  }
  button {
    font-size: 18px;
    padding: 8px 15px;
    margin: 0 4px;
    border-radius: 6px;
    border: none;
    background: #00cfff;
    color: #111;
    font-weight: bold;
    user-select:none;
  }
  button:active {
    background: #0099cc;
  }
  #menu, #shop, #rating, #gameOverScreen {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #111;
    border: 3px solid #00ffff;
    border-radius: 15px;
    padding: 20px;
    width: 320px;
    box-sizing: border-box;
    text-align: center;
    display: none;
    color: #0ff;
    user-select:none;
  }
  #menu h1 {
    font-family: 'Minecraftia', monospace;
    font-size: 48px;
    margin-bottom: 20px;
    color:#0ff;
    text-shadow: 0 0 10px #0ff;
  }
  #shop .skin, #shop .booster {
    display: inline-block;
    margin: 8px;
    border: 2px solid #0ff;
    border-radius: 8px;
    cursor: pointer;
    padding: 6px;
    width: 70px;
    user-select:none;
  }
  #shop .skin img, #shop .booster img {
    width: 64px;
    height: 64px;
    display:block;
    margin: 0 auto 6px auto;
  }
  #shop .owned {
    border-color: #0f0;
  }
  #shop .selected {
    box-shadow: 0 0 8px 3px #0ff;
  }
  #rating-list {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 10px;
    text-align: left;
  }
</style>
</head>
<body>

<canvas id="game" width="320" height="480"></canvas>

<div id="ui">
  <div>Монеты: <span id="coins">0</span></div>
  <div>Высота: <span id="height">0</span> м</div>
</div>

<!-- Меню -->
<div id="menu">
  <h1>Social Lift</h1>
  <button id="btnPlay">Играть</button>
  <button id="btnShop">Магазин</button>
  <button id="btnRating">Рейтинг</button>
</div>

<!-- Магазин -->
<div id="shop">
  <h2>Магазин скинов</h2>
  <div id="skinsContainer"></div>
  <h2>Усилители</h2>
  <div id="boostersContainer"></div>
  <button id="btnShopBack">Назад</button>
  <div>Баланс: <span id="shopCoins">0</span> монет</div>
</div>

<!-- Рейтинг -->
<div id="rating">
  <h2>Рейтинг игроков</h2>
  <div id="rating-list"></div>
  <button id="btnRatingBack">Назад</button>
</div>

<!-- Экран конца игры -->
<div id="gameOverScreen">
  <h2>Игра окончена</h2>
  <div>Высота: <span id="finalHeight">0</span> м</div>
  <div>Заработано монет: <span id="earnedCoins">0</span></div>
  <button id="btnRestart">Играть заново</button>
  <button id="btnGameOverMenu">В меню</button>
</div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width;
  const H = canvas.height;

  // UI элементы
  const uiCoins = document.getElementById('coins');
  const uiHeight = document.getElementById('height');
  const menu = document.getElementById('menu');
  const shop = document.getElementById('shop');
  const rating = document.getElementById('rating');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const skinsContainer = document.getElementById('skinsContainer');
  const boostersContainer = document.getElementById('boostersContainer');
  const ratingList = document.getElementById('rating-list');
  const shopCoins = document.getElementById('shopCoins');
  const finalHeightSpan = document.getElementById('finalHeight');
  const earnedCoinsSpan = document.getElementById('earnedCoins');

  // Кнопки
  const btnPlay = document.getElementById('btnPlay');
  const btnShop = document.getElementById('btnShop');
  const btnRating = document.getElementById('btnRating');
  const btnShopBack = document.getElementById('btnShopBack');
  const btnRatingBack = document.getElementById('btnRatingBack');
  const btnRestart = document.getElementById('btnRestart');
  const btnGameOverMenu = document.getElementById('btnGameOverMenu');

  // Состояния
  const STATE = {
    MENU: 'menu',
    GAME: 'game',
    SHOP: 'shop',
    RATING: 'rating',
    GAMEOVER: 'gameover'
  };
  let currentState = STATE.MENU;

  // Монеты и сохранение
  let coins = parseInt(localStorage.getItem('coins') || '0');
  let ownedSkins = JSON.parse(localStorage.getItem('ownedSkins') || '["default"]');
  let selectedSkin = localStorage.getItem('selectedSkin') || 'default';
  let ownedBoosters = JSON.parse(localStorage.getItem('ownedBoosters') || '[]');
  let selectedBoosters = JSON.parse(localStorage.getItem('selectedBoosters') || '[]');

  // Рейтинг (топ 10)
  let ratings = JSON.parse(localStorage.getItem('ratings') || '[]');

  // Игровые константы
  const GRAVITY = 0.5;
  const PLAYER_JUMP_VY = -10;
  const PLAYER_WIDTH = 40;
  const PLAYER_HEIGHT = 60;
  const PLATFORM_WIDTH = 70;
  const PLATFORM_HEIGHT = 15;
  const PLATFORM_GAP = 120;
  const MAX_PLATFORMS_ON_SCREEN = 10;

  // Персонаж
  let player;
  // Платформы
  let platforms;
  // Враги
  let enemies;
  // Монеты на уровнях (не внутриигровые, а бонусные)
  let levelCoins;

  // Счет и высота
  let maxHeight;

  // Время игры и сложность
  let gameTime;
  let enemySpawnInterval;
  let lastEnemySpawn;

  // Сенсорное управление
  let isTouching = false;
  let touchX = 0;

  // Усилители
  const BOOSTERS = [
    {
      id: 'doubleCoins',
      name: 'Удвоение монет',
      description: 'В два раза больше монет',
      price: 200,
      owned: false,
    },
    {
      id: 'highJump',
      name: 'Высокий прыжок',
      description: 'Прыжок выше на 50%',
      price: 300,
      owned: false,
    },
    {
      id: 'slowFall',
      name: 'Медленное падение',
      description: 'Падение замедляется',
      price: 250,
      owned: false,
    },
    {
      id: 'shield',
      name: 'Щит',
      description: 'Защита от врага 1 раз',
      price: 400,
      owned: false,
    },
  ];

  // Скины (с пиксельным артом на canvas)
  const SKINS = [
    {
      id: 'default',
      name: 'Стандартный',
      price: 0,
      draw(ctx, x, y) {
        // простой синий человечек
        ctx.fillStyle = '#0099ff';
        ctx.fillRect(x, y, PLAYER_WIDTH, PLAYER_HEIGHT);
        ctx.fillStyle = '#004477';
        ctx.fillRect(x+10, y+10, 20, 20);
      }
    },
    {
      id: 'red',
      name: 'Красный',
      price: 100,
      draw(ctx, x, y) {
        ctx.fillStyle = '#cc0000';
        ctx.fillRect(x, y, PLAYER_WIDTH, PLAYER_HEIGHT);
        ctx.fillStyle = '#660000';
        ctx.fillRect(x+10, y+10, 20, 20);
      }
    },
    {
      id: 'green',
      name: 'Зеленый',
      price: 150,
      draw(ctx, x, y) {
        ctx.fillStyle = '#00cc00';
        ctx.fillRect(x, y, PLAYER_WIDTH, PLAYER_HEIGHT);
        ctx.fillStyle = '#006600';
        ctx.fillRect(x+10, y+10, 20, 20);
      }
    },
    {
      id: 'pixelGuy',
      name: 'Пиксельный парень',
      price: 250,
      draw(ctx, x, y) {
        // тело
        ctx.fillStyle = '#ffcc00';
        ctx.fillRect(x+10, y+10, 20, 40);
        // голова
        ctx.fillStyle = '#ffffcc';
        ctx.fillRect(x+5, y, 30, 20);
        // глаза
        ctx.fillStyle = '#000';
        ctx.fillRect(x+12, y+6, 5, 5);
        ctx.fillRect(x+23, y+6, 5, 5);
      }
    },
    {
      id: 'robot',
      name: 'Робот',
      price: 350,
      draw(ctx, x, y) {
        ctx.fillStyle = '#666';
        ctx.fillRect(x, y, PLAYER_WIDTH, PLAYER_HEIGHT);
        ctx.fillStyle = '#333';
        ctx.fillRect(x+10, y+10, 20, 40);
        ctx.fillStyle = '#0ff';
        ctx.fillRect(x+12, y+15, 16, 10);
      }
    },
    {
      id: 'wizard',
      name: 'Волшебник',
      price: 400,
      draw(ctx, x, y) {
        ctx.fillStyle = '#440088';
        ctx.fillRect(x, y, PLAYER_WIDTH, PLAYER_HEIGHT);
        ctx.fillStyle = '#aa55ff';
        ctx.fillRect(x+15, y+15, 10, 10);
        // шляпа
        ctx.fillStyle = '#222';
        ctx.beginPath();
        ctx.moveTo(x+20, y);
        ctx.lineTo(x+10, y+15);
        ctx.lineTo(x+30, y+15);
        ctx.closePath();
        ctx.fill();
      }
    }
  ];

  // Выбранный скин объект
  function getSelectedSkin() {
    return SKINS.find(s => s.id === selectedSkin) || SKINS[0];
  }

  // Игрок
  class Player {
    constructor() {
      this.x = W/2 - PLAYER_WIDTH/2;
      this.y = H - 150;
      this.vx = 0;
      this.vy = 0;
      this.width = PLAYER_WIDTH;
      this.height = PLAYER_HEIGHT;
      this.isOnPlatform = false;
      this.shield = 0; // счетчик щита
    }
    update() {
      this.vy += GRAVITY;
      this.x += this.vx;

      if(this.x < 0) this.x = 0;
      if(this.x + this.width > W) this.x = W - this.width;

      this.y += this.vy;

      if(this.y + this.height > H) {
        this.y = H - this.height;
        this.vy = 0;
        this.isOnPlatform = true;
      }
    }
    jump() {
      let jumpPower = PLAYER_JUMP_VY;
      if (selectedBoosters.includes('highJump')) {
        jumpPower *= 1.5;
      }
      this.vy = jumpPower;
      this.isOnPlatform = false;
    }
    draw() {
      getSelectedSkin().draw(ctx, this.x, this.y);
      if(this.shield > 0) {
        ctx.strokeStyle = '#0ff';
        ctx.lineWidth = 3;
        ctx.strokeRect(this.x - 5, this.y - 5, this.width + 10, this.height + 10);
      }
    }
  }

  // Платформа
  class Platform {
    constructor(x, y, moving=false) {
      this.x = x;
      this.y = y;
      this.width = PLATFORM_WIDTH;
      this.height = PLATFORM_HEIGHT;
      this.moving = moving;
      this.dir = 1;
      this.speed = moving ? 1.5 : 0;
    }
    update() {
      if(this.moving) {
        this.x += this.speed * this.dir;
        if(this.x <= 0 || this.x + this.width >= W) this.dir *= -1;
      }
    }
    draw() {
      ctx.fillStyle = '#00ffff';
      ctx.fillRect(this.x, this.y, this.width, this.height);
      ctx.strokeStyle = '#004444';
      ctx.strokeRect(this.x, this.y, this.width, this.height);
    }
  }

  // Враг
  class Enemy {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.width = 30;
      this.height = 30;
      this.vx = 1 + Math.random() * 1;
      this.vy = 0;
      this.dir = 1;
    }
    update() {
      this.x += this.vx * this.dir;
      if(this.x < 0 || this.x + this.width > W) this.dir *= -1;
    }
    draw() {
      ctx.fillStyle = '#ff0000';
      ctx.fillRect(this.x, this.y, this.width, this.height);
      ctx.strokeStyle = '#770000';
      ctx.strokeRect(this.x, this.y, this.width, this.height);
    }
  }

  // Генерация платформ
  function generateInitialPlatforms() {
    platforms = [];
    let y = H - 50;
    // стартовая платформа, чтобы не упасть сразу
    platforms.push(new Platform(W/2 - PLATFORM_WIDTH/2, y));
    for(let i = 1; i < MAX_PLATFORMS_ON_SCREEN; i++) {
      y -= PLATFORM_GAP;
      let x = Math.random() * (W - PLATFORM_WIDTH);
      let moving = Math.random() < 0.3;
      platforms.push(new Platform(x, y, moving));
    }
  }

  // Генерация врагов
  function spawnEnemy() {
    const y = player.y - (Math.random()*300 + 200);
    const x = Math.random() * (W - 30);
    enemies.push(new Enemy(x, y));
  }

  // Проверка коллизий с платформами
  function checkPlatformCollision() {
    player.isOnPlatform = false;
    for(let plat of platforms) {
      if(player.vy > 0 &&
        player.x + player.width > plat.x &&
        player.x < plat.x + plat.width &&
        player.y + player.height >= plat.y &&
        player.y + player.height <= plat.y + plat.height + player.vy) {
        player.y = plat.y - player.height;
        player.vy = 0;
        player.isOnPlatform = true;
        break;
      }
    }
  }

  // Проверка коллизий с врагами
  function checkEnemyCollision() {
    for(let i = 0; i < enemies.length; i++) {
      const e = enemies[i];
      if(
        player.x < e.x + e.width &&
        player.x + player.width > e.x &&
        player.y < e.y + e.height &&
        player.y + player.height > e.y
      ) {
        if(player.shield > 0) {
          player.shield--;
          enemies.splice(i, 1);
          i--;
          return false; // не конец игры
        } else {
          return true; // конец игры
        }
      }
    }
    return false;
  }

  // Обработка монеток с усилителями
  function coinsEarned(base) {
    if(selectedBoosters.includes('doubleCoins')) return base*2;
    return base;
  }

  // Отрисовка текста с тенью для читаемости
  function drawTextShadow(text, x, y, color='#0ff', size=24) {
    ctx.font = `${size}px Arial Black`;
    ctx.fillStyle = '#000';
    ctx.fillText(text, x+2, y+2);
    ctx.fillStyle = color;
    ctx.fillText(text, x, y);
  }

  // Отрисовка экрана меню (заставка + кнопки)
  function showMenu() {
    menu.style.display = 'block
// Завершение игры
function gameOver() {
  isGameOver = true;
  gameRunning = false;

  if (score > highScore) {
    highScore = score;
    localStorage.setItem("highScore", highScore);
  }

  // Отправка очков в Telegram
  sendScoreToTelegram(score);

  // Показываем экран окончания игры
  showGameOverScreen(score, highScore);
}

// Показываем экран окончания игры
function showGameOverScreen(score, highScore) {
  const gameOverScreen = document.createElement('div');
  gameOverScreen.id = 'gameOverScreen';
  gameOverScreen.innerHTML = `
    <h2>Игра окончена</h2>
    <p>Ты набрал: <strong>${score} м</strong></p>
    <p>Рекорд: <strong>${highScore} м</strong></p>
    <button id="restartBtn">Играть снова</button>
  `;
  document.body.appendChild(gameOverScreen);

  document.getElementById("restartBtn").onclick = () => {
    document.body.removeChild(gameOverScreen);
    restartGame();
  };
}

// Перезапуск игры
function restartGame() {
  score = 0;
  player.x = canvas.width / 2;
  player.y = canvas.height - 100;
  player.vy = 0;
  platforms.length = 0;
  coins.length = 0;
  slObjects.length = 0;
  generateInitialPlatforms();
  isGameOver = false;
  gameRunning = true;
  gameLoop();
}

// Telegram API интеграция
function sendScoreToTelegram(score) {
  if (window.Telegram.WebApp) {
    Telegram.WebApp.sendData(JSON.stringify({ type: "score", value: score }));
  }
}

// Рейтинг игроков (получение)
async function fetchLeaderboard() {
  const response = await fetch("https://your-server.com/leaderboard");
  const data = await response.json();
  return data.topPlayers;
}

// Отображение рейтинга
async function showLeaderboard() {
  const leaderboard = await fetchLeaderboard();
  const leaderboardScreen = document.createElement('div');
  leaderboardScreen.id = 'leaderboardScreen';
  leaderboardScreen.innerHTML = `<h2>Топ игроки</h2><ul>${
    leaderboard.map(p => `<li>${p.username}: ${p.score} м</li>`).join("")
  }</ul><button id="backBtn">Назад</button>`;

  document.body.appendChild(leaderboardScreen);
  document.getElementById("backBtn").onclick = () => {
    document.body.removeChild(leaderboardScreen);
  };
}
      ctx.fillText('Игра окончена!', WIDTH / 2, HEIGHT / 2 - 30);
      ctx.fillText('Твой рекорд: ' + Math.floor(highScore) + ' м', WIDTH / 2, HEIGHT / 2);
      ctx.fillText('Монеты: ' + coins, WIDTH / 2, HEIGHT / 2 + 30);
      drawButton(WIDTH / 2 - 60, HEIGHT / 2 + 60, 120, 30, 'В меню', () => {
        state = 'menu';
        currentScore = 0;
        player = { ...player, y: HEIGHT - 50, vy: 0 };
        generateInitialPlatforms();
      });
    }

    function updateGame() {
      if (state !== 'game') return;
      player.vy += gravity;
      player.y += player.vy;

      if (player.y < HEIGHT / 2 && player.vy < 0) {
        const dy = HEIGHT / 2 - player.y;
        player.y = HEIGHT / 2;
        platforms.forEach(p => p.y += dy);
        coinsList.forEach(c => c.y += dy);
        enemies.forEach(e => e.y += dy);
        backgroundOffset += dy;
        currentScore += dy * 0.05;
        if (currentScore > highScore) highScore = currentScore;
      }

      if (player.y > HEIGHT) {
        state = 'gameover';
        if (currentScore > highScore) highScore = currentScore;
        localStorage.setItem('coins', coins);
        localStorage.setItem('highScore', highScore);
      }

      platforms.forEach((platform, i) => {
        if (
          player.vy > 0 &&
          player.x + player.width > platform.x &&
          player.x < platform.x + platform.width &&
          player.y + player.height > platform.y &&
          player.y + player.height < platform.y + platform.height
        ) {
          player.vy = jumpStrength;
        }

        if (platform.y > HEIGHT) {
          platforms.splice(i, 1);
          const newPlatform = {
            x: Math.random() * (WIDTH - 60),
            y: 0,
            width: 60,
            height: 10,
            type: Math.random() < 0.1 ? 'moving' : 'static',
            dx: (Math.random() - 0.5) * 2,
          };
          platforms.push(newPlatform);
        }

        if (platform.type === 'moving') {
          platform.x += platform.dx;
          if (platform.x <= 0 || platform.x + platform.width >= WIDTH) {
            platform.dx *= -1;
          }
        }
      });

      coinsList.forEach((coin, i) => {
        if (
          player.x + player.width > coin.x &&
          player.x < coin.x + coin.size &&
          player.y + player.height > coin.y &&
          player.y < coin.y + coin.size
        ) {
          coins += 1;
          coinsList.splice(i, 1);
        }

        if (coin.y > HEIGHT) {
          coinsList.splice(i, 1);
        }
      });

      enemies.forEach((enemy, i) => {
        if (
          player.x + player.width > enemy.x &&
          player.x < enemy.x + enemy.size &&
          player.y + player.height > enemy.y &&
          player.y < enemy.y + enemy.size
        ) {
          state = 'gameover';
          localStorage.setItem('coins', coins);
        }

        enemy.y += 1 + Math.random();

        if (enemy.y > HEIGHT) {
          enemies.splice(i, 1);
        }
      });

      if (Math.random() < 0.01) {
        enemies.push({
          x: Math.random() * (WIDTH - 20),
          y: -20,
          size: 20,
        });
      }

      drawGame();
      requestAnimationFrame(updateGame);
    }

    function drawButton(x, y, w, h, text, onClick) {
      ctx.fillStyle = '#007bff';
      ctx.fillRect(x, y, w, h);
      ctx.fillStyle = '#fff';
      ctx.font = '16px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(text, x + w / 2, y + h / 2);
      canvas.addEventListener('click', function handler(e) {
        const rect = canvas.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const clickY = e.clientY - rect.top;
        if (clickX >= x && clickX <= x + w && clickY >= y && clickY <= y + h) {
          canvas.removeEventListener('click', handler);
          onClick();
        }
      });
    }

    function startGameLoop() {
      requestAnimationFrame(updateGame);
    }

    drawStartScreen();
  </script>
</body>
</html> 



<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Social Lift Jump — Улучшенная версия</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
  body, html {
    margin: 0; padding: 0; height: 100%; touch-action: manipulation;
    background: linear-gradient(to top, #0b3d91, #1e5fcf);
    font-family: 'Montserrat', sans-serif;
    color: #fff;
    user-select: none;
    overflow: hidden;
  }
  #gameContainer {
    position: relative;
    width: 100%;
    height: 100%;
    max-width: 100vw;
    max-height: 100vh;
    margin: 0 auto;
    overflow: hidden;
  }
  #gameCanvas {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: transparent;
    border-radius: 16px;
    box-shadow: 0 0 30px #00bfff;
    touch-action: none;
  }
  #ui {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 400px;
    display: flex;
    justify-content: space-between;
    font-size: 16px;
    font-weight: 700;
    z-index: 10;
    pointer-events: none;
  }
  .screen {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 90%;
    max-width: 400px;
    max-height: 80vh;
    padding: 20px;
    background: rgba(16, 42, 67, 0.95);
    border-radius: 20px;
    box-shadow: 0 0 40px #00bfffcc;
    transform: translate(-50%, -50%);
    text-align: center;
    color: #fff;
    user-select: none;
    z-index: 10;
    display: none;
    overflow-y: auto;
    pointer-events: auto;
  }
  .screen.active {
    display: block;
  }
  button {
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    font-size: 16px;
    padding: 12px 24px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background-color: #00bfff;
    color: #000;
    margin: 8px;
    box-shadow: 0 0 20px #00bfffaa;
    user-select: none;
    transition: all 0.2s ease;
    width: 80%;
    max-width: 250px;
  }
  button:hover, button:active {
    background-color: #0099cc;
    transform: scale(0.98);
  }
  #splashScreen {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 90%;
    max-width: 400px;
    padding: 20px;
    background: transparent;
    color: #00bfff;
    font-size: 32px;
    font-weight: 900;
    text-align: center;
    transform: translate(-50%, -50%);
    user-select: none;
    z-index: 100;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.7);
  }
  .shop-item {
    margin: 12px 0;
    padding: 12px;
    background: rgba(0,0,0,0.2);
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .skin-preview {
    width: 50px;
    height: 50px;
    margin: 5px auto;
    border-radius: 50%;
    background-size: cover;
    background-position: center;
    border: 2px solid #00bfff;
    box-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
  }
  .boost-desc {
    display: block;
    font-size: 12px;
    color: #aaa;
    margin-top: 5px;
  }
  .controls {
    position: absolute;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: center;
    z-index: 5;
    pointer-events: none;
  }
  .control-btn {
    width: 60px;
    height: 60px;
    background: rgba(0, 191, 255, 0.3);
    border-radius: 50%;
    margin: 0 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    color: white;
    pointer-events: auto;
    touch-action: manipulation;
    border: 2px solid rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 15px rgba(0, 191, 255, 0.5);
  }
  .skin-name {
    font-weight: bold;
    margin: 5px 0;
  }
  .skin-price {
    color: #FFD700;
    font-size: 14px;
  }
  @media (min-width: 500px) {
    button {
      font-size: 18px;
      padding: 14px 28px;
    }
    #ui {
      font-size: 18px;
    }
    .skin-preview {
      width: 60px;
      height: 60px;
    }
  }
</style>
</head>
<body>

<div id="splashScreen">Social Lift Game</div>

<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  
  <div id="ui">
    <div>Высота: <span id="score">0</span> м</div>
    <div>Монеты: <span id="coins">0</span></div>
  </div>
  
  <div class="controls">
    <div class="control-btn" id="leftBtn">←</div>
    <div class="control-btn" id="rightBtn">→</div>
  </div>
</div>

<div id="menu" class="screen">
  <h2>Social Lift Jump</h2>
  <button id="startGameBtn">Начать игру</button>
  <button id="openShopBtn">Магазин</button>
  <button id="openRatingBtn">Рейтинг</button>
</div>

<div id="gameOverScreen" class="screen">
  <h2>Игра окончена</h2>
  <p>Ваш результат: <span id="finalScore">0</span> м</p>
  <p>Монеты: <span id="finalCoins">0</span></p>
  <button id="restartGameBtn">Сыграть еще раз</button>
  <button id="goToMenuBtn1">Меню</button>
</div>

<div id="shopScreen" class="screen">
  <h2>Магазин</h2>
  <div>Монеты: <span id="shopCoins">0</span></div>
  <h3>Скины</h3>
  <div id="skinsList"></div>
  <h3>Усилители</h3>
  <div id="boostersList"></div>
  <button id="closeShopBtn">Назад</button>
</div>

<div id="ratingScreen" class="screen">
  <h2>Рейтинг игроков</h2>
  <div id="ratingList">Рейтинг доступен локально</div>
  <button id="closeRatingBtn">Назад</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Адаптивное разрешение
  const gameContainer = document.getElementById('gameContainer');
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  
  function resizeCanvas() {
    const isPortrait = window.innerHeight > window.innerWidth;
    const maxWidth = Math.min(window.innerWidth, 500);
    const maxHeight = Math.min(window.innerHeight, 800);
    
    if (isPortrait) {
      canvas.width = maxWidth * 0.9;
      canvas.height = maxHeight * 0.8;
    } else {
      canvas.width = maxWidth * 0.7;
      canvas.height = maxHeight * 0.9;
    }
  }
  
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  
  const width = canvas.width;
  const height = canvas.height;

  // Элементы интерфейса
  const splashScreen = document.getElementById('splashScreen');
  const menu = document.getElementById('menu');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const shopScreen = document.getElementById('shopScreen');
  const ratingScreen = document.getElementById('ratingScreen');
  const scoreEl = document.getElementById('score');
  const coinsEl = document.getElementById('coins');
  const startGameBtn = document.getElementById('startGameBtn');
  const openShopBtn = document.getElementById('openShopBtn');
  const openRatingBtn = document.getElementById('openRatingBtn');
  const finalScoreEl = document.getElementById('finalScore');
  const finalCoinsEl = document.getElementById('finalCoins');
  const restartGameBtn = document.getElementById('restartGameBtn');
  const goToMenuBtn1 = document.getElementById('goToMenuBtn1');
  const skinsList = document.getElementById('skinsList');
  const boostersList = document.getElementById('boostersList');
  const shopCoinsEl = document.getElementById('shopCoins');
  const closeShopBtn = document.getElementById('closeShopBtn');
  const ratingList = document.getElementById('ratingList');
  const closeRatingBtn = document.getElementById('closeRatingBtn');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');

  // Переменные игры
  let player = { 
    x: width/2 - 18, 
    y: height - 140, 
    width: 36, 
    height: 36, 
    vy: 0, 
    vx: 0, 
    gravity: 0.35, 
    jumpForce: -10, 
    speedX: 0,
    targetSpeedX: 0
  };
  
  let platforms = [];
  const platformGap = 50;
  let scrollOffset = 0;
  let gameOver = false;
  let coinsCount = 0;
  let playerCoins = parseInt(localStorage.getItem('playerCoins')) || 0;
  let ownedSkins = JSON.parse(localStorage.getItem('ownedSkins') || '[0]');
  let selectedSkin = parseInt(localStorage.getItem('selectedSkin') || '0');
  let playerBoosts = JSON.parse(localStorage.getItem('playerBoosts') || '{"jump":0,"coin":0}');

  // Улучшенная система скинов
  const skins = [
    { id: 0, name: 'Голубой', price: 0, color: '#00BFFF', img: null },
    { id: 1, name: 'Белый', price: 100, color: '#FFFFFF', img: null },
    { id: 2, name: 'Черный', price: 150, color: '#000000', img: null },
    { id: 3, name: 'Красный', price: 200, color: '#FF0000', img: null },
    { id: 4, name: 'Зелёный', price: 250, color: '#00FF00', img: null },
    { id: 5, name: 'Оранжевый', price: 300, color: '#FFA500', img: null },
    { id: 6, name: 'Розовый', price: 350, color: '#FFC0CB', img: null },
    { id: 7, name: 'Фиолетовый', price: 400, color: '#800080', img: null },
    { id: 8, name: 'Золотой', price: 500, color: '#FFD700', img: null },
    { id: 9, name: 'Серебряный', price: 450, color: '#C0C0C0', img: null },
    { id: 10, name: 'Радужный', price: 600, color: 'linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet)', img: null },
    { id: 11, name: 'Утка', price: 500, color: '#00BFFF', img: 'https://i.imgur.com/7yUvePI.png' },
    { id: 12, name: 'SL-Бренд', price: 750, color: '#00BFFF', img: 'https://i.imgur.com/3qXQ9kK.png' },
    { id: 13, name: 'Космонавт', price: 800, color: '#FFFFFF', img: 'https://i.imgur.com/JqYeZQp.png' },
    { id: 14, name: 'Ниндзя', price: 700, color: '#000000', img: 'https://i.imgur.com/nKQeYqW.png' },
    { id: 15, name: 'Робот', price: 650, color: '#AAAAAA', img: 'https://i.imgur.com/RvLQJbT.png' },
    { id: 16, name: 'Секретный', price: 0, color: '#FFD700', img: 'https://i.imgur.com/secretSkin.png', unlockScore: 5000 },
    { id: 17, name: 'Дракон', price: 900, color: '#FF4500', img: 'https://i.imgur.com/dragonSkin.png' },
    { id: 18, name: 'Единорог', price: 850, color: '#FF69B4', img: 'https://i.imgur.com/unicornSkin.png' },
    { id: 19, name: 'Пришелец', price: 950, color: '#7CFC00', img: 'https://i.imgur.com/alienSkin.png' }
  ];

  // Предзагрузка изображений скинов
  skins.forEach(skin => {
    if (skin.img) {
      skin._img = new Image();
      skin._img.src = skin.img;
    }
  });

  const boosters = [
    { id: 'jump', name: 'Прыжок +2', price: 150, description: 'Увеличивает силу прыжка на 2' },
    { id: 'coin', name: 'Монеты x2', price: 200, description: 'Удваивает сбор монет' },
    { id: 'gravity', name: 'Антигравитация', price: 300, description: 'Уменьшает гравитацию на 30%' },
    { id: 'speed', name: 'Скорость +1', price: 250, description: 'Увеличивает скорость движения' }
  ];

  class Platform {
    constructor(x, y, w, h, type='static') {
      this.x = x;
      this.y = y;
      this.w = w;
      this.h = h;
      this.type = type;
      this.moveDir = 1;
      this.moveSpeed = 1.5;
      this.moveRange = 60;
      this.baseX = x;
      this.coin = Math.random() < 0.35;
      this.coinCollected = false;
      this.broken = false;
      this.visible = true;
      this.disappearTimer = 0;
    }
    update() {
      if(this.type === 'moving') {
        this.x += this.moveSpeed * this.moveDir;
        if(this.x > this.baseX + this.moveRange || this.x < this.baseX - this.moveRange) {
          this.moveDir *= -1;
        }
      }
      if(this.type === 'breaking' && this.broken) {
        this.disappearTimer++;
        if(this.disappearTimer > 60) {
          this.visible = false;
        }
      }
    }
    draw(ctx) {
      if(!this.visible) return;
      ctx.fillStyle = this.type === 'breaking' ? '#ff6600' : '#00BFFF';
      ctx.fillRect(this.x, this.y, this.w, this.h);
      if(this.coin && !this.coinCollected) {
        const cx = this.x + this.w/2;
        const cy = this.y - 15;
        const r = 10;
        ctx.fillStyle = '#FFD700';
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = '#B8860B';
        ctx.lineWidth = 1.5;
        ctx.stroke();
        ctx.fillStyle = '#333';
        ctx.font = 'bold 10px Montserrat, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('SL', cx, cy);
      }
    }
  }

  // Звёздный фон
  const stars = [];
  const starCount = 60;
  for(let i=0; i<starCount; i++) {
    stars.push({
      x: Math.random()*width,
      y: Math.random()*height,
      r: Math.random()*1.5 + 0.5,
      speed: (Math.random()*0.3)+0.05
    });
  }
  function drawStars() {
    ctx.fillStyle = '#fff';
    stars.forEach(s => {
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
      s.y += s.speed;
      if(s.y > height) s.y = 0;
    });
  }

  // Отрисовка игрока
  function drawPlayer() {
    const skin = skins.find(s => s.id === selectedSkin);
    
    if(skin && skin.img && skin._img && skin._img.complete) {
      ctx.drawImage(skin._img, player.x, player.y, player.width, player.height);
    } else if (skin && skin.color) {
      if (skin.color.includes('gradient')) {
        // Обработка градиентных скинов
        const gradient = ctx.createLinearGradient(player.x, player.y, player.x + player.width, player.y + player.height);
        gradient.addColorStop(0, 'red');
        gradient.addColorStop(0.16, 'orange');
        gradient.addColorStop(0.32, 'yellow');
        gradient.addColorStop(0.48, 'green');
        gradient.addColorStop(0.64, 'blue');
        gradient.addColorStop(0.8, 'indigo');
        gradient.addColorStop(1, 'violet');
        ctx.fillStyle = gradient;
      } else {
        ctx.fillStyle = skin.color;
      }
      ctx.fillRect(player.x, player.y, player.width, player.height);
    } else {
      // Стандартный скин (утка)
      const scale = player.width / 8;
      ctx.save();
      ctx.translate(player.x, player.y);
      ctx.fillStyle = '#FFD700';
      ctx.fillRect(scale*1, scale*2, scale*6, scale*4); // тело
      ctx.fillRect(scale*5, scale*0, scale*2, scale*2); // голова
      ctx.fillStyle = '#000';
      ctx.fillRect(scale*6, scale*1, scale*1, scale*1); // глаз
      ctx.fillStyle = '#FFA500';
      ctx.beginPath(); // клюв
      ctx.moveTo(scale*7, scale*2);
      ctx.lineTo(scale*8, scale*1.5);
      ctx.lineTo(scale*7, scale*3);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }
  }

  // Улучшенное управление
  let leftPressed = false;
  let rightPressed = false;
  
  // Клавиатура
  window.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft' || e.key === 'a') leftPressed = true;
    if(e.key === 'ArrowRight' || e.key === 'd') rightPressed = true;
    if((e.key === ' ' || e.key === 'w' || e.key === 'ArrowUp') && !gameOver) {
      player.vy = player.jumpForce - (playerBoosts.jump || 0);
    }
  });
  
  window.addEventListener('keyup', e => {
    if(e.key === 'ArrowLeft' || e.key === 'a') leftPressed = false;
    if(e.key === 'ArrowRight' || e.key === 'd') rightPressed = false;
  });
  
  // Сенсорное управление
  leftBtn.addEventListener('touchstart', e => {
    e.preventDefault();
    leftPressed = true;
  });
  
  rightBtn.addEventListener('touchstart', e => {
    e.preventDefault();
    rightPressed = true;
  });
  
  leftBtn.addEventListener('touchend', e => {
    e.preventDefault();
    leftPressed = false;
  });
  
  rightBtn.addEventListener('touchend', e => {
    e.preventDefault();
    rightPressed = false;
  });
  
  leftBtn.addEventListener('mousedown', () => leftPressed = true);
  rightBtn.addEventListener('mousedown', () => rightPressed = true);
  leftBtn.addEventListener('mouseup', () => leftPressed = false);
  rightBtn.addEventListener('mouseup', () => leftPressed = false);
  leftBtn.addEventListener('mouseleave', () => leftPressed = false);
  rightBtn.addEventListener('mouseleave', () => rightPressed = false);
  
  // Плавное управление с инерцией
  function handleMovement() {
    const acceleration = 0.2;
    const deceleration = 0.15;
    const maxSpeed = 5 + (playerBoosts.speed || 0);
    
    // Определяем целевое направление
    if(leftPressed) player.targetSpeedX = -maxSpeed;
    else if(rightPressed) player.targetSpeedX = maxSpeed;
    else player.targetSpeedX = 0;
    
    // Плавное изменение скорости
    if(player.speedX < player.targetSpeedX) {
      player.speedX = Math.min(player.speedX + acceleration, player.targetSpeedX);
    } else if(player.speedX > player.targetSpeedX) {
      player.speedX = Math.max(player.speedX - acceleration, player.targetSpeedX);
    }
    
    // Если не нажаты кнопки - замедление
    if(!leftPressed && !rightPressed) {
      if(Math.abs(player.speedX) < deceleration) player.speedX = 0;
      else if(player.speedX > 0) player.speedX -= deceleration;
      else if(player.speedX < 0) player.speedX += deceleration;
    }
    
    player.vx = player.speedX;
  }

  function createPlatformAbove(y) {
    let x = Math.random() * (width - 80);
    let typeRand = Math.random();
    let type = 'static';
    if(typeRand < 0.2) type = 'moving';
    else if(typeRand < 0.35) type = 'breaking';
    return new Platform(x, y, 80, 15, type);
  }

  function createPlatforms() {
    platforms = [];
    platforms.push(new Platform(width/2 - 50, height - 100, 100, 15, 'static'));
    let y = height - 150;
    while(y > -2000) {
      platforms.push(createPlatformAbove(y));
      y -= platformGap + Math.random() * 20;
    }
  }

  function updatePlatforms() {
    platforms.forEach(p => p.update());
    platforms = platforms.filter(p => p.visible && p.y < height + 50);
    while(platforms.length < 15) {
      let minY = Math.min(...platforms.map(p => p.y));
      platforms.push(createPlatformAbove(minY - platformGap - Math.random() * 20));
    }
  }

  function updatePlayer() {
    player.vy += player.gravity * (playerBoosts.gravity ? 0.7 : 1);
    player.y += player.vy;
    player.x += player.vx;

    if(player.x + player.width < 0) player.x = width;
    else if(player.x > width) player.x = -player.width;

    for(let plat of platforms) {
      if(!plat.visible) continue;
      if(plat.type === 'breaking' && plat.broken && plat.disappearTimer > 30) continue;
      if(
        player.vy > 0 &&
        player.x + player.width > plat.x &&
        player.x < plat.x + plat.w &&
        player.y + player.height > plat.y &&
        player.y + player.height < plat.y + plat.h
      ) {
        player.y = plat.y - player.height;
        player.vy = player.jumpForce - (playerBoosts.jump || 0);
        if(plat.type === 'breaking') {
          plat.broken = true;
        }
        if(plat.coin && !plat.coinCollected) {
          plat.coinCollected = true;
          const coinAdd = (playerBoosts.coin ? 2 : 1);
          coinsCount += coinAdd;
          playerCoins += coinAdd;
          updateCoinsUI();
          saveProgress();
        }
        break;
      }
    }

    if(player.y > height) {
      gameOver = true;
      endGame();
    }
  }

  function drawPlatforms() {
    platforms.forEach(p => p.draw(ctx));
  }

  function gameLoop() {
    if(gameOver) return;
    ctx.clearRect(0, 0, width, height);
    drawStars();
    handleMovement();
    updatePlayer();
    updatePlatforms();

    if(player.y < height/2) {
      let diff = (height/2) - player.y;
      player.y += diff;
      platforms.forEach(p => p.y += diff);
      scrollOffset += diff;
      coinsCount = Math.max(0, Math.floor(scrollOffset/10));
      scoreEl.textContent = coinsCount;
    }

    drawPlatforms();
    drawPlayer();

    requestAnimationFrame(gameLoop);
  }

  function updateCoinsUI() {
    coinsEl.textContent = playerCoins;
    shopCoinsEl.textContent = playerCoins;
  }

  function startGame() {
    gameOver = false;
    scrollOffset = 0;
    coinsCount = 0;
    player.x = width/2 - 18;
    player.y = height - 140;
    player.vx = 0;
    player.vy = 0;
    player.speedX = 0;
    player.targetSpeedX = 0;
    player.gravity = 0.35;
    player.jumpForce = -10;
    createPlatforms();
    updateCoinsUI();
    scoreEl.textContent = '0';
    coinsEl.textContent = playerCoins;
    splashScreen.style.display = 'none';
    menu.classList.remove('active');
    gameOverScreen.classList.remove('active');
    shopScreen.classList.remove('active');
    ratingScreen.classList.remove('active');
    requestAnimationFrame(gameLoop);
  }

  function endGame() {
    finalScoreEl.textContent = coinsCount;
    finalCoinsEl.textContent = coinsCount;
    menu.classList.remove('active');
    gameOverScreen.classList.add('active');
    saveProgress();
  }

  // Прыжок по тапу/клику
  canvas.addEventListener('click', () => {
    if(gameOver) return;
    player.vy = player.jumpForce - (playerBoosts.jump || 0);
  });
  
  canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    if(gameOver) return;
    player.vy = player.jumpForce - (playerBoosts.jump || 0);
  }, { passive: false });

  // Магазин
  function renderShop() {
    shopCoinsEl.textContent = playerCoins;
    skinsList.innerHTML = skins.map(skin => {
      const owned = ownedSkins.includes(skin.id);
      const selected = selectedSkin === skin.id;
      const canUnlock = skin.unlockScore ? coinsCount >= skin.unlockScore : true;
      const bgStyle = skin.img ? `background-image:url(${skin.img});` : 
                     skin.color.includes('gradient') ? 'background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);' : 
                     `background-color:${skin.color};`;
      return `
        <div class="shop-item">
          <div class="skin-preview" style="${bgStyle}"></div>
          <div class="skin-name">${skin.name}</div>
          ${skin.unlockScore ? `<div>От ${skin.unlockScore} очков</div>` : `<div class="skin-price">${skin.price} SL</div>`}
          <div>
            ${owned ? (selected ? '<b>Выбрано</b>' : `<button data-id="${skin.id}">Выбрать</button>`) 
                    : (canUnlock ? `<button data-id="${skin.id}">${skin.price ? 'Купить' : 'Разблокировать'}</button>` : '<i>Недоступен</i>')}
          </div>
        </div>
      `;
    }).join('');
    
    boostersList.innerHTML = boosters.map(b => {
      const ownedLevel = playerBoosts[b.id] || 0;
      return `
        <div class="shop-item">
          <div>${b.name} (Ур. ${ownedLevel})<span class="boost-desc">${b.description}</span></div>
          <div><button data-id="${b.id}">Купить (${b.price} SL)</button></div>
        </div>
      `;
    }).join('');
  }
  
  skinsList.addEventListener('click', e => {
    if(e.target.tagName === 'BUTTON') {
      const id = parseInt(e.target.getAttribute('data-id'));
      if(e.target.textContent.includes('Купить') || e.target.textContent.includes('Разблокировать')) buySkin(id);
      else if(e.target.textContent.includes('Выбрать')) selectSkin(id);
    }
  });
  
  boostersList.addEventListener('click', e => {
    if(e.target.tagName === 'BUTTON') {
      const id = e.target.getAttribute('data-id');
      buyBooster(id);
    }
  });
  
  function buySkin(id) {
    const skin = skins.find(s => s.id === id);
    if(skin.price > 0 && playerCoins < skin.price) return alert('Недостаточно монет!');
    if(skin.price > 0) playerCoins -= skin.price;
    if(!ownedSkins.includes(id)) ownedSkins.push(id);
    saveProgress();
    updateCoinsUI();
    renderShop();
  }
  
  function selectSkin(id) {
    selectedSkin = id;
    saveProgress();
    renderShop();
  }
  
  function buyBooster(id) {
    const booster = boosters.find(b => b.id === id);
    if(playerCoins < booster.price) return alert('Недостаточно монет!');
    playerCoins -= booster.price;
    playerBoosts[id] = (playerBoosts[id] || 0) + 1;
    saveProgress();
    updateCoinsUI();
    renderShop();
  }
  
  function saveProgress() {
    localStorage.setItem('playerCoins', playerCoins);
    localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
    localStorage.setItem('selectedSkin', selectedSkin);
    localStorage.setItem('playerBoosts', JSON.stringify(playerBoosts));
    let localLeaderboard = JSON.parse(localStorage.getItem('localLeaderboard') || '[]');
    localLeaderboard.push({name: 'Игрок', score: coinsCount});
    localLeaderboard.sort((a,b) => b.score - a.score);
    if(localLeaderboard.length > 10) localLeaderboard.length = 10;
    localStorage.setItem('localLeaderboard', JSON.stringify(localLeaderboard));
  }

  // Обработчики кнопок
  startGameBtn.addEventListener('click', startGame);
  restartGameBtn.addEventListener('click', startGame);
  goToMenuBtn1.addEventListener('click', () => {
    gameOverScreen.classList.remove('active');
    menu.classList.add('active');
  });
  openShopBtn.addEventListener('click', () => {
    renderShop();
    shopScreen.classList.add('active');
  });
  closeShopBtn.addEventListener('click', () => {
    shopScreen.classList.remove('active');
  });
  openRatingBtn.addEventListener('click', () => {
    const localLeaderboard = JSON.parse(localStorage.getItem('localLeaderboard') || '[]');
    if(localLeaderboard.length === 0) {
      ratingList.textContent = 'Рейтинг пуст';
    } else {
      ratingList.innerHTML = localLeaderboard.map((u,i) =>
        `<b>${i+1}.</b> ${u.name} <span style="float:right">${u.score} м</span>`
      ).join('<br>');
    }
    ratingScreen.classList.add('active');
  });
  closeRatingBtn.addEventListener('click', () => {
    ratingScreen.classList.remove('active');
  });

  // Стартовый экран-заставка
  setTimeout(() => {
    splashScreen.style.display = 'none';
    menu.classList.add('active');
  }, 2000);
});
</script>
</body>
</html>

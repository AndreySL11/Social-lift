<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Social Lift Jump - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    body, html {
      margin: 0; padding: 0; overflow: hidden;
      font-family: 'Montserrat', sans-serif;
      background: #1E2A47;
      color: #fff;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    #gameCanvas {
      display: block;
      background: linear-gradient(to top, #2c3e50 0%, #3498db 100%);
      margin: 0 auto;
      border: 2px solid #2980b9;
      box-shadow: 0 0 15px #2980b9aa;
    }
    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(30, 42, 71, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      color: #fff;
    }
    button {
      background: #3498db;
      border: none;
      border-radius: 6px;
      padding: 12px 25px;
      margin: 8px;
      font-weight: 700;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 3px 8px #2980b9;
      transition: background 0.3s;
      min-width: 160px;
    }
    button:hover {
      background: #2980b9;
    }
    .shopItem {
      padding: 10px;
      margin: 6px 0;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 2px 6px #00000055;
    }
    .shopItem.selected {
      border: 2px solid #FFD700;
      box-shadow: 0 0 15px #FFD700;
    }
    .shopList {
      max-height: 200px;
      overflow-y: auto;
      width: 300px;
      margin: 10px 0;
      background: #27436e;
      padding: 10px;
      border-radius: 8px;
      box-shadow: inset 0 0 8px #00000055;
    }
    #uiTop {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      font-weight: 700;
      text-shadow: 0 0 8px #00000088;
      user-select: none;
      z-index: 5;
    }
    #coinsEl {
      margin-left: 20px;
      color: #FFD700;
    }
    #buttonsMenu {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <div id="uiTop">–í—ã—Å–æ—Ç–∞: <span id="scoreEl">0</span> –º <span id="coinsEl">üí∞ 0</span></div>

  <!-- –ú–µ–Ω—é –ó–∞—Å—Ç–∞–≤–∫–∏ -->
  <div id="startScreen" class="overlay">
    <h1>Social Lift Jump</h1>
    <button id="startGameBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>

  <!-- –ú–µ–Ω—é –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏ -->
  <div id="gameOverMenu" class="overlay hidden">
    <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
    <p>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="finalScore">0</span> –º</p>
    <div id="buttonsMenu">
      <button id="restartBtn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
      <button id="openShopBtn">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button id="openRatingBtn">–†–µ–π—Ç–∏–Ω–≥</button>
    </div>
  </div>

  <!-- –ú–∞–≥–∞–∑–∏–Ω -->
  <div id="shopPanel" class="overlay hidden" style="max-width: 350px;">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    <h3>–°–∫–∏–Ω—ã</h3>
    <div id="skinsList" class="shopList"></div>
    <h3>–£—Å–∏–ª–∏—Ç–µ–ª–∏</h3>
    <div id="boostersList" class="shopList"></div>
    <button id="closeShopBtn" style="margin-top: 20px;">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –†–µ–π—Ç–∏–Ω–≥ -->
  <div id="ratingPanel" class="overlay hidden" style="max-width: 350px;">
    <h2>–†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
    <div id="ratingList" class="shopList" style="color:#ffd700; font-weight:700;"></div>
    <button id="closeRatingBtn" style="margin-top: 20px;">–ù–∞–∑–∞–¥</button>
  </div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;

  const scoreEl = document.getElementById('scoreEl');
  const coinsEl = document.getElementById('coinsEl');

  const startScreen = document.getElementById('startScreen');
  const gameOverMenu = document.getElementById('gameOverMenu');
  const finalScoreEl = document.getElementById('finalScore');
  const restartBtn = document.getElementById('restartBtn');
  const openShopBtn = document.getElementById('openShopBtn');
  const openRatingBtn = document.getElementById('openRatingBtn');

  const shopPanel = document.getElementById('shopPanel');
  const skinsList = document.getElementById('skinsList');
  const boostersList = document.getElementById('boostersList');
  const closeShopBtn = document.getElementById('closeShopBtn');

  const ratingPanel = document.getElementById('ratingPanel');
  const ratingList = document.getElementById('ratingList');
  const closeRatingBtn = document.getElementById('closeRatingBtn');

  const startGameBtn = document.getElementById('startGameBtn');

  // --- –ò–≥—Ä–æ–∫ ---
  const player = {
    width: 30,
    height: 40,
    x: width/2 - 15,
    y: height - 140,
    vx: 0,
    vy: 0,
    baseJumpForce: -12,
    jumpForce: -12,
    baseSpeedX: 3,
    speedX: 3,
    gravity: 0.6,
    color: '#FFD700'
  };

  let moveDirection = 0; // -1 –≤–ª–µ–≤–æ, 1 –≤–ø—Ä–∞–≤–æ

  // --- –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã ---
  class Platform {
    constructor(x, y, width, height, type='static') {
      this.x = x;
      this.y = y;
      this.width = width;
      this.height = height;
      this.type = type; // 'static' –∏–ª–∏ 'moving'
      this.vx = (type === 'moving') ? 1.5 : 0;
      this.direction = 1;
      this.coin = Math.random() < 0.3;
      this.coinCollected = false;
    }
    update() {
      if (this.type === 'moving') {
        this.x += this.vx * this.direction;
        if (this.x < 0 || this.x + this.width > width) {
          this.direction *= -1;
        }
      }
    }
    draw(ctx) {
      ctx.fillStyle = (this.type === 'moving') ? '#2980b9' : '#34495e';
      ctx.fillRect(this.x, this.y, this.width, this.height);
      if (this.coin && !this.coinCollected) {
        ctx.fillStyle = '#FFD700';
        ctx.beginPath();
        ctx.arc(this.x + this.width/2, this.y - 8, 6, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  }

  let platforms = [];
  const maxPlatforms = 10;
  const platformGap = 80;

  // --- –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ---
  function createStartPlatform() {
    // —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–Ω–∏–∑—É –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ
    const sp = new Platform(width/2 - 40, height - 100, 80, 14, 'static');
    return sp;
  }

  // --- –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º ---
  function createInitialPlatforms() {
    platforms = [];
    platforms.push(createStartPlatform());

    let baseY = height - 100 - platformGap;
    for (let i = 1; i < maxPlatforms; i++) {
      const x = Math.random() * (width - 70);
      const y = baseY - (i-1) * platformGap;
      const type = (i > 3 && Math.random() < 0.4) ? 'moving' : 'static';
      platforms.push(new Platform(x, y, 70, 12, type));
    }
  }

  // --- –†–µ–π—Ç–∏–Ω–≥ ---
  // –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ Telegram API, –ø–æ–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ:
  let playersRating = [
    { name: 'User1', score: 230 },
    { name: 'User2', score: 180 },
    { name: 'User3', score: 140 },
  ];

  function updateRating(currentScore) {
    const username = window.Telegram?.WebApp?.initDataUnsafe?.user?.username || 'Player';
    let found = playersRating.find(p => p.name === username);
    if (!found) {
      playersRating.push({ name: username, score: currentScore });
    } else {
      if (currentScore > found.score) found.score = currentScore;
    }
    playersRating.sort((a,b) => b.score - a.score);
    if (playersRating.length > 10) playersRating.length = 10;
  }

  function showRatingPanel() {
    ratingList.innerHTML = playersRating.map(p => `${p.name}: ${p.score} –º`).join('<br>');
    ratingPanel.classList.remove('hidden');
  }

  // --- –°–∫–∏–Ω—ã ---
  const skins = [
    { name: '–ó–æ–ª–æ—Ç–æ–π', color: '#FFD700' },
    { name: '–ì–æ–ª—É–±–æ–π', color: '#4A90E2' },
    { name: '–ó–µ–ª–µ–Ω—ã–π', color: '#2ECC71' },
    { name: '–ö—Ä–∞—Å–Ω—ã–π', color: '#E74C3C' },
    { name: '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π', color: '#9B59B6' },
  ];

  // --- –£—Å–∏–ª–∏—Ç–µ–ª–∏ ---
  const boosters = [
    { name: '–°–∏–ª–∞ –ø—Ä—ã–∂–∫–∞ +2', type: 'jump', value: -2, description: '–ü—Ä—ã–∂–æ–∫ –≤—ã—à–µ' },
    { name: '–°–∫–æ—Ä–æ—Å—Ç—å +1', type: 'speed', value: 1, description: '–ë—ã—Å—Ç—Ä–µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ' },
  ];

  // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–∫–∏–Ω –∏ —É—Å–∏–ª–∏—Ç–µ–ª–∏
  let selectedSkinIndex = 0;
  let selectedBoosters = { jump: 0, speed: 0 };

  function initShop() {
    skinsList.innerHTML = '';
    skins.forEach((skin, i) => {
      const div = document.createElement('div');
      div.className = 'shopItem' + (i === selectedSkinIndex ? ' selected' : '');
      div.textContent = skin.name;
      div.style.backgroundColor = skin.color;
      div.style.color = i === 0 ? '#000' : '#fff';
      div.title = skin.name;
      div.addEventListener('click', () => {
        selectedSkinIndex = i;
        player.color = skins[i].color;
        updateShopUI();
      });
      skinsList.appendChild(div);
    });

    boostersList.innerHTML = '';
    boosters.forEach((boost, i) => {
      const div = document.createElement('div');
      div.className = 'shopItem' + ((selectedBoosters.jump === boost.value && boost.type==='jump') || (selectedBoosters.speed === boost.value && boost.type==='speed') ? ' selected' : '');
      div.textContent = boost.name;
      div.title = boost.description;
      div.addEventListener('click', () => {
        if (boost.type === 'jump') selectedBoosters.jump = boost.value;
        else if (boost.type === 'speed') selectedBoosters.speed = boost.value;
        updatePlayerBoosters();
        updateShopUI();
      });
      boostersList.appendChild(div);
    });
  }

  function updateShopUI() {
    Array.from(skinsList.children).forEach((el, i) => {
      el.classList.toggle('selected', i === selectedSkinIndex);
    });
    Array.from(boostersList.children).forEach((el, i) => {
      const boost = boosters[i];
      const active = (boost.type === 'jump' && selectedBoosters.jump === boost.value) ||
                     (boost.type === 'speed' && selectedBoosters.speed === boost.value);
      el.classList.toggle('selected', active);
    });
  }

  function updatePlayerBoosters() {
    player.jumpForce = player.baseJumpForce + selectedBoosters.jump;
    player.speedX = player.baseSpeedX + selectedBoosters.speed;
  }

  // --- –ò–≥—Ä–∞ ---
  let score = 0;
  let coins = 0;
  let isPlaying = false;

  function resetGame() {
    score = 0;
    coins = 0;
    player.x = width / 2 - player.width / 2;
    player.y = height - 140;
    player.vx = 0;
    player.vy = 0;
    updatePlayerBoosters();
    createInitialPlatforms();
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–∏ –∏–≥—Ä–æ–∫–∞ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π —Å–Ω–∏–∑—É
  function checkCollision(platform) {
    const playerBottom = player.y + player.height;
    const platformTop = platform.y;
    if (playerBottom <= platformTop && playerBottom + player.vy >= platformTop &&
        player.x + player.width > platform.x && player.x < platform.x + platform.width &&
        player.vy >= 0) {
      return true;
    }
    return false;
  }

  // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ---
  function handleInput(e) {
    if (e.type === 'keydown') {
      if (e.key === 'ArrowLeft') moveDirection = -1;
      else if (e.key === 'ArrowRight') moveDirection = 1;
    } else if (e.type === 'keyup') {
      if ((e.key === 'ArrowLeft' && moveDirection === -1) || (e.key === 'ArrowRight' && moveDirection === 1)) {
        moveDirection = 0;
      }
    }
  }

  window.addEventListener('keydown', handleInput);
  window.addEventListener('keyup', handleInput);

  // --- –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª ---
  function gameLoop() {
    if (!isPlaying) return;

    ctx.clearRect(0, 0, width, height);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
    player.vy += player.gravity;
    player.x += player.vx;
    player.y += player.vy;

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º –¥–≤–∏–∂–µ–Ω–∏–µ–º
    player.vx = player.speedX * moveDirection;

    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã (–ø–µ—Ä–µ–Ω–æ—Å –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏)
    if (player.x > width) player.x = -player.width;
    else if (player.x + player.width < 0) player.x = width;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
    let onPlatform = false;
    for (const p of platforms) {
      p.update();

      if (checkCollision(p)) {
        onPlatform = true;
        player.vy = player.jumpForce;
        player.y = p.y - player.height;

        // –°–æ–±–∏—Ä–∞–µ–º –º–æ–Ω–µ—Ç—É, –µ—Å–ª–∏ –µ—Å—Ç—å
        if (p.coin && !p.coinCollected) {
          coins++;
          p.coinCollected = true;
        }
      }
    }

    // –ï—Å–ª–∏ –ø–∞–¥–∞–µ–º –Ω–∏–∂–µ —ç–∫—Ä–∞–Ω–∞ ‚Äî –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
    if (player.y > height) {
      endGame();
      return;
    }

    // –°–∫—Ä–æ–ª–ª–∏–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –∏–≥—Ä–æ–∫–∞ –≤–≤–µ—Ä—Ö –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Å–µ—Ä–µ–¥–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
    if (player.y < height / 2) {
      const dy = height / 2 - player.y;
      player.y = height / 2;

      platforms.forEach(p => {
        p.y += dy;
      });

      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å–Ω–∏–∑—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
      while (platforms.length < maxPlatforms) {
        let lastY = platforms[platforms.length - 1].y;
        let x = Math.random() * (width - 70);
        let y = lastY - platformGap;
        let type = (Math.random() < 0.4) ? 'moving' : 'static';
        platforms.push(new Platform(x, y, 70, 12, type));
      }

      // –£–±–∏—Ä–∞–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –≤—ã—à–µ–¥—à–∏–µ –∑–∞ –Ω–∏–∑ —ç–∫—Ä–∞–Ω–∞
      platforms = platforms.filter(p => p.y < height + 20);
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç (–≤—ã—Å–æ—Ç—É)
    score = Math.max(score, Math.floor(height - player.y));
    scoreEl.textContent = score;
    coinsEl.textContent = `üí∞ ${coins}`;

    // –†–∏—Å—É–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    platforms.forEach(p => p.draw(ctx));

    // –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);

    requestAnimationFrame(gameLoop);
  }

  // --- –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã ---
  function startGame() {
    resetGame();
    isPlaying = true;
    startScreen.classList.add('hidden');
    gameOverMenu.classList.add('hidden');
    shopPanel.classList.add('hidden');
    ratingPanel.classList.add('hidden');
    scoreEl.textContent = '0';
    coinsEl.textContent = 'üí∞ 0';
    gameLoop();
  }

  // --- –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã ---
  function endGame() {
    isPlaying = false;
    finalScoreEl.textContent = score;
    updateRating(score);
    gameOverMenu.classList.remove('hidden');
  }

  // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ ---
  startGameBtn.onclick = () => startGame();
  restartBtn.onclick = () => startGame();

  openShopBtn.onclick = () => {
    gameOverMenu.classList.add('hidden');
    shopPanel.classList.remove('hidden');
  };

  closeShopBtn.onclick = () => {
    shopPanel.classList.add('hidden');
    gameOverMenu.classList.remove('hidden');
  };

  openRatingBtn.onclick = () => {
    gameOverMenu.classList.add('hidden');
    showRatingPanel();
  };

  closeRatingBtn.onclick = () => {
    ratingPanel.classList.add('hidden');
    gameOverMenu.classList.remove('hidden');
  };

  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞ ---
  initShop();
  player.color = skins[selectedSkinIndex].color;
  updatePlayerBoosters();

})();
</script>
</body>
</html>


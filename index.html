<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Social Lift Jump</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
    body { margin:0; overflow:hidden; font-family:'Montserrat',sans-serif; background:#000; color:#fff; }
    #splash {
      position:absolute; top:0; left:0; width:100%; height:100%;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      background:#000; z-index:10;
    }
    #splash h1 {
      font-size:4em; text-shadow:2px 2px #00dfff; margin:0;
    }
    #splash p { margin:10px; }
    #splash button {
      margin-top:20px; padding:10px 20px; font-size:1.2em;
      background:#00dfff; color:#000; border:none; border-radius:8px;
      cursor:pointer;
    }
    #gameCanvas { display:none; margin:auto; background:#000; border:2px solid #00dfff; }
    #ui {
      position:fixed; top:10px; left:10px;
      display:flex; flex-wrap:wrap; gap:10px;
      font-size:18px; color:#00dfff;
      text-shadow:0 0 2px #000;
      pointer-events:none;
    }
    .btn { background:#00dfff; color:#000; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; pointer-events:auto; }
    #rating { position:fixed; top:10px; right:10px; width:200px; background:rgba(0,0,0,0.5); padding:10px; border:1px solid #00dfff; border-radius:8px; max-height:80vh; overflow:auto; }
    #rating h2 { margin:0 0 10px 0; font-size:18px; color:#fff; text-align:center; }
    #rating ul { list-style:none; padding:0; margin:0; }
    #rating li { margin-bottom:6px; }
    #inviteBtn { position:fixed; bottom:10px; left:50%; transform:translateX(-50%); background:#00dfff; color:#000; padding:8px 16px; border:none; border-radius:8px; cursor:pointer; pointer-events:auto; }
  </style>
</head>
<body>
  <div id="splash">
    <h1>Social Lift</h1>
    <p id="splash-date">‚Äî</p>
    <button id="startBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>

  <canvas id="gameCanvas" width="320" height="480"></canvas>
  <div id="ui">
    <div>–í—ã—Å–æ—Ç–∞: <span id="score">0</span> –º</div>
    <div>–ú–æ–Ω–µ—Ç—ã: <span id="coins">0</span></div>
    <button id="boostBtn" class="btn">–ë—É—Å—Ç–µ—Ä x2</button>
    <button id="statsBtn" class="btn">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
  </div>
  <div id="rating">
    <h2>–†–µ–π—Ç–∏–Ω–≥</h2>
    <ul id="ratingList"></ul>
  </div>
  <button id="inviteBtn">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</button>

<script>
(() => {
  // –ü–æ–ª—É—á–∞–µ–º –∏–º—è —á–µ—Ä–µ–∑ Telegram WebApp API
  const tg = window.Telegram.WebApp;
  tg.expand();  
  const playerName = tg.initDataUnsafe?.user?.first_name || '–ò–≥—Ä–æ–∫';

  // Splash: –¥–∞—Ç–∞ –∏ –∫–Ω–æ–ø–∫–∞
  document.getElementById('splash-date').textContent = new Date().toLocaleString();
  document.getElementById('startBtn').addEventListener('click', startGame);

  // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const width = canvas.width, height = canvas.height;
  const scoreEl = document.getElementById('score');
  const coinsEl = document.getElementById('coins');
  const ratingList = document.getElementById('ratingList');
  const boostBtn = document.getElementById('boostBtn');
  const statsBtn = document.getElementById('statsBtn');
  const inviteBtn = document.getElementById('inviteBtn');

  let score = 0, coins = 0, gameOver = false, boostActive = false, boostTimer = 0;
  let platforms = [], scrollOffset = 0;

  class Platform { /* –∫–æ–ø–∏—Ä—É–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞ */ }
  // ... Platform –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, update, draw –∫–∞–∫ —Ä–∞–Ω–µ–µ

  function createPlatforms() { /* –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è */ }
  function drawPlayer() { /* –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è */ }

  // –ò–≥—Ä–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (update, draw, loop) ‚Äî –±–µ—Ä—ë–º –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞, –≤–ø–∏—Å—ã–≤–∞–µ–º —Å—é–¥–∞

  function startGame() {
    document.getElementById('splash').style.display = 'none';
    canvas.style.display = 'block';
    resetGame();
    loop();
  }

  // –†–µ–π—Ç–∏–Ω–≥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage
  function loadRating() {
    return JSON.parse(localStorage.getItem('sl_rating')||'[]');
  }
  function saveRating(data) {
    localStorage.setItem('sl_rating', JSON.stringify(data));
  }
  function updateRating() {
    const data = loadRating();
    const idx = data.findIndex(o => o.name === playerName);
    if (idx < 0) data.push({name:playerName, score});
    else if (score > data[idx].score) data[idx].score = score;
    data.sort((a,b)=>b.score-a.score);
    saveRating(data.slice(0,10));
    ratingList.innerHTML = '';
    loadRating().forEach((o,i)=>ratingList.innerHTML += `<li>${i+1}. ${o.name}: ${o.score} –º</li>`);
  }

  // –ë—É—Ñ–µ—Ä —Ñ—É–Ω–∫—Ü–∏–π: boost, stats, invite
  boostBtn.addEventListener('click', () => {
    boostActive = true;
    boostTimer = 10000;
    boostBtn.disabled = true;
    setTimeout(()=>{
      boostActive=false;
      boostBtn.disabled = false;
    }, boostTimer);
  });

  statsBtn.addEventListener('click', () => {
    alert(`–ò–≥—Ä–æ–∫: ${playerName}\n–í—ã—Å–æ—Ç–∞: ${score} –º\n–ú–æ–Ω–µ—Ç—ã: ${coins}`);
  });

  inviteBtn.addEventListener('click', () => {
    tg.shareData ? tg.shareData() : alert('–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è¬ª üòä');
  });

  function gameOverHandler() {
    updateRating();
    statsBtn.click();
  }

  function resetGame() {
    score = coins = scrollOffset = 0;
    gameOver = false;
    boostActive = false;
    document.getElementById('score').textContent = '0';
    document.getElementById('coins').textContent = '0';
    createPlatforms();
  }

  function loop() {
    if (gameOver) {
      gameOverHandler();
      return;
    }
    // update()/draw() –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞, —Å —É—á—ë—Ç–æ–º boostActive (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–º–Ω–æ–∂–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
    requestAnimationFrame(loop);
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
  updateRating();
})();
</script>
</body>
</html>

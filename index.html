<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Social Lift Jump</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: sans-serif;
      background: #e6f7ff;
    }
    canvas {
      display: block;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #000;
      font-size: 18px;
      z-index: 10;
    }
    #menu {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .button {
      padding: 12px 24px;
      margin: 10px;
      background: #00aaff;
      color: white;
      border: none;
      font-size: 20px;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui">
    <div>Монеты SL: <span id="coins">0</span></div>
    <div>Счёт: <span id="score">0</span></div>
  </div>
  <div id="menu">
    <h1>Social Lift Jump</h1>
    <button class="button" onclick="startGame()">Играть</button>
    <button class="button" onclick="openShop()">Магазин</button>
    <button class="button" onclick="openLeaderboard()">Рейтинг</button>
  </div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let width, height;
    let platforms = [], enemies = [], coins = [], player;
    let score = 0, slCoins = 0, isGameOver = false;

    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }

    window.addEventListener("resize", resize);
    resize();

    class Player {
      constructor() {
        this.x = width / 2;
        this.y = height - 100;
        this.vx = 0;
        this.vy = -10;
        this.width = 40;
        this.height = 40;
      }
      update() {
        this.vy += 0.4;
        this.x += this.vx;
        this.y += this.vy;

        // wrap horizontal
        if (this.x < -this.width) this.x = width;
        if (this.x > width) this.x = -this.width;

        // collision with platforms
        for (let p of platforms) {
          if (
            this.vy > 0 &&
            this.x + this.width > p.x &&
            this.x < p.x + p.width &&
            this.y + this.height > p.y &&
            this.y + this.height < p.y + p.height
          ) {
            this.vy = -12;
          }
        }

        // collision with coins
        coins = coins.filter(c => {
          if (
            this.x + this.width > c.x &&
            this.x < c.x + c.size &&
            this.y + this.height > c.y &&
            this.y < c.y + c.size
          ) {
            slCoins += 1;
            document.getElementById("coins").textContent = slCoins;
            return false;
          }
          return true;
        });

        // collision with enemies
        for (let e of enemies) {
          if (
            this.x + this.width > e.x &&
            this.x < e.x + e.size &&
            this.y + this.height > e.y &&
            this.y < e.y + e.size
          ) {
            gameOver();
          }
        }

        if (this.y > height) gameOver();
      }
      draw() {
        ctx.fillStyle = "black";
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    }

    function generatePlatform(y) {
      const x = Math.random() * (width - 100);
      platforms.push({ x, y, width: 100, height: 10 });
      if (Math.random() < 0.3) coins.push({ x: x + 40, y: y - 20, size: 20 });
      if (Math.random() < 0.2) enemies.push({ x: x + 50, y: y - 30, size: 30 });
    }

    function drawPlatforms() {
      ctx.fillStyle = "#00aaff";
      for (let p of platforms) {
        ctx.fillRect(p.x, p.y, p.width, p.height);
      }
    }

    function drawCoins() {
      ctx.fillStyle = "gold";
      for (let c of coins) {
        ctx.beginPath();
        ctx.arc(c.x + c.size/2, c.y + c.size/2, c.size/2, 0, 2 * Math.PI);
        ctx.fill();
      }
    }

    function drawEnemies() {
      ctx.fillStyle = "red";
      for (let e of enemies) {
        ctx.fillRect(e.x, e.y, e.size, e.size);
      }
    }

    function gameLoop() {
      ctx.clearRect(0, 0, width, height);

      player.update();
      platforms = platforms.filter(p => p.y < height + 100);
      enemies = enemies.filter(e => e.y < height + 100);
      coins = coins.filter(c => c.y < height + 100);

      const offsetY = height / 2 - player.y;
      if (offsetY > 0) {
        player.y += offsetY;
        platforms.forEach(p => p.y += offsetY);
        coins.forEach(c => c.y += offsetY);
        enemies.forEach(e => e.y += offsetY);
        score += Math.floor(offsetY);
        document.getElementById("score").textContent = score;
        generatePlatform(platforms[platforms.length - 1].y - 100);
      }

      drawPlatforms();
      drawCoins();
      drawEnemies();
      player.draw();

      if (!isGameOver) requestAnimationFrame(gameLoop);
    }

    function startGame() {
      document.getElementById("menu").style.display = "none";
      platforms = [];
      enemies = [];
      coins = [];
      for (let y = height; y > -5000; y -= 150) {
        generatePlatform(y);
      }
      score = 0;
      slCoins = 0;
      isGameOver = false;
      player = new Player();
      gameLoop();
    }

    function gameOver() {
      isGameOver = true;
      alert("Игра окончена! Ваш счёт: " + score);
      location.reload();
    }

    function openShop() {
      alert("Магазин временно недоступен. Монеты: " + slCoins);
    }

    function openLeaderboard() {
      alert("Рейтинг пока не реализован.");
    }

    canvas.addEventListener("touchmove", e => {
      const touch = e.touches[0];
      if (touch) {
        const dx = touch.clientX - width / 2;
        player.vx = dx * 0.05;
      }
    });
  </script>
</body>
</html>

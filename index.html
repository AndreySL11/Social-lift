<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Social Lift Jump</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  body {
    margin: 0; padding: 0; overflow: hidden;
    background: linear-gradient(#99ccff, #ffffff);
    font-family: 'Press Start 2P', monospace;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }
  #gameCanvas {
    background: #87ceeb;
    display: block;
    margin: 0 auto;
    border: 2px solid black;
  }
  #menu, #shop, #rating, #gameOverScreen {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255 255 255 / 0.9);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    display: none;
  }
  #menu.active, #shop.active, #rating.active, #gameOverScreen.active {
    display: block;
  }
  button {
    font-family: 'Press Start 2P', monospace;
    font-size: 14px;
    margin: 8px;
    padding: 10px 15px;
    cursor: pointer;
  }
</style>
</head>
<body>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<!-- Меню -->
<div id="menu" class="active">
  <h1>Social Lift Jump</h1>
  <button id="btnPlay">Играть</button>
  <button id="btnShop">Магазин</button>
  <button id="btnRating">Рейтинг</button>
</div>

<!-- Магазин -->
<div id="shop">
  <h2>Магазин скинов</h2>
  <div id="skinsList"></div>
  <button id="btnShopBack">Назад</button>
</div>

<!-- Рейтинг -->
<div id="rating">
  <h2>Рейтинг</h2>
  <div id="ratingList">Пока пусто</div>
  <button id="btnRatingBack">Назад</button>
</div>

<!-- Экран проигрыша -->
<div id="gameOverScreen">
  <h2>Игра окончена</h2>
  <p>Очки: <span id="finalScore">0</span></p>
  <button id="btnRestart">Начать заново</button>
  <button id="btnMenu">В меню</button>
</div>

<script>
// --- Основные переменные ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const menu = document.getElementById('menu');
const shop = document.getElementById('shop');
const rating = document.getElementById('rating');
const gameOverScreen = document.getElementById('gameOverScreen');

const btnPlay = document.getElementById('btnPlay');
const btnShop = document.getElementById('btnShop');
const btnRating = document.getElementById('btnRating');
const btnShopBack = document.getElementById('btnShopBack');
const btnRatingBack = document.getElementById('btnRatingBack');
const btnRestart = document.getElementById('btnRestart');
const btnMenu = document.getElementById('btnMenu');

const skinsList = document.getElementById('skinsList');
const ratingList = document.getElementById('ratingList');
const finalScoreSpan = document.getElementById('finalScore');

let gameState = 'menu'; // menu, playing, gameover, shop, rating
let animationFrameId = null;

let score = 0;
let player = null;
let platforms = [];
let keys = {};
let gravity = 0.6;

// --- Скины (для простоты просто цвета) ---
const skins = [
  { id: 'default', color: '#ff4500', price: 0 },
  { id: 'blue', color: '#1e90ff', price: 100 },
  { id: 'green', color: '#32cd32', price: 200 },
];
let ownedSkins = JSON.parse(localStorage.getItem('ownedSkins')) || ['default'];
let selectedSkin = localStorage.getItem('selectedSkin') || 'default';
let coins = parseInt(localStorage.getItem('coins')) || 0;

// --- Класс игрока ---
class Player {
  constructor(x, y, width, height, color) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
    this.color = color;
    this.vx = 0;
    this.vy = 0;
    this.jumping = false;
    this.shield = 0;
  }
  update() {
    this.vy += gravity;
    this.x += this.vx;
    this.y += this.vy;

    // Границы канваса по горизонтали
    if (this.x < 0) this.x = 0;
    if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;

    // Если упал вниз — конец игры
    if (this.y > canvas.height) {
      endGame();
    }

    // Платформы
    for (const p of platforms) {
      if (
        this.vy > 0 &&
        this.x + this.width > p.x &&
        this.x < p.x + p.width &&
        this.y + this.height > p.y &&
        this.y + this.height < p.y + p.height
      ) {
        this.y = p.y - this.height;
        this.vy = -15; // прыжок от платформы
        this.jumping = false;
      }
    }
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);

    if(this.shield > 0) {
      ctx.strokeStyle = '#0ff';
      ctx.lineWidth = 3;
      ctx.strokeRect(this.x - 2, this.y - 2, this.width + 4, this.height + 4);
    }
  }
}

// --- Платформа ---
class Platform {
  constructor(x, y, width=80, height=15) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
  }
  draw() {
    ctx.fillStyle = '#654321';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

// --- Инициализация игры ---
function initGame() {
  score = 0;
  player = new Player(180, 500, 40, 40, getSkinColor(selectedSkin));
  platforms = [];
  // Стартовая платформа
  platforms.push(new Platform(160, 550, 80, 15));
  gameState = 'playing';
  menu.classList.remove('active');
  shop.classList.remove('active');
  rating.classList.remove('active');
  gameOverScreen.classList.remove('active');
  canvas.style.display = 'block';
  loop();
}

// --- Основной цикл ---
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if(gameState === 'playing') {
    player.update();
    player.draw();

    platforms.forEach(p => p.draw());

    // Отображение очков
    ctx.fillStyle = 'black';
    ctx.font = '20px Arial';
    ctx.fillText('Очки: ' + score, 10, 30);

    // Добавляем платформы если надо
    if(platforms[platforms.length - 1].y > 150) {
      const last = platforms[platforms.length - 1];
      const newX = Math.random() * (canvas.width - 80);
      const newY = last.y - 100;
      platforms.push(new Platform(newX, newY));
      score++;
    }

    animationFrameId = requestAnimationFrame(loop);
  }
}

// --- Конец игры ---
function endGame() {
  gameState = 'gameover';
  cancelAnimationFrame(animationFrameId);
  canvas.style.display = 'none';
  finalScoreSpan.textContent = score;
  gameOverScreen.classList.add('active');

  // Сохраняем монеты как очки
  coins += score;
  localStorage.setItem('coins', coins);
}

// --- Получить цвет скина ---
function getSkinColor(skinId) {
  const skin = skins.find(s => s.id === skinId);
  return skin ? skin.color : '#ff4500';
}

// --- Отрисовка магазина ---
function renderShop() {
  skinsList.innerHTML = '';
  skins.forEach(skin => {
    const owned = ownedSkins.includes(skin.id);
    const btn = document.createElement('button');
    btn.textContent = `${skin.id} (${skin.price} монет)`;
    btn.disabled = owned ? false : coins < skin.price;
    btn.style.backgroundColor = getSkinColor(skin.id);
    btn.style.color = '#fff';
    btn.onclick = () => {
      if (!owned) {
        if (coins >= skin.price) {
          coins -= skin.price;
          ownedSkins.push(skin.id);
          localStorage.setItem('coins', coins);
          localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
          alert(`Вы купили скин ${skin.id}`);
          renderShop();
        }
      } else {
        selectedSkin = skin.id;
        localStorage.setItem('selectedSkin', selectedSkin);
        alert(`Вы выбрали скин ${skin.id}`);
      }
    };
    skinsList.appendChild(btn);
  });
}

// --- Рендеринг рейтинга (пока пустой) ---
function renderRating() {
  ratingList.textContent = 'Рейтинг пока отсутствует.';
}

// --- Обработчики кнопок ---
btnPlay.onclick = () => initGame();

btnShop.onclick = () => {
  gameState = 'shop';
  menu.classList.remove('active');
  shop.classList.add('active');
  renderShop();
  canvas.style.display = 'none';
};

btnRating.onclick = () => {
  gameState = 'rating';
  menu.classList.remove('active');
  rating.classList.add('active');
  renderRating();
  canvas.style.display = 'none';
};

btnShopBack.onclick = () => {
  gameState = 'menu';
  shop.classList.remove('active');
  menu.classList.add('active');
};

btnRatingBack.onclick = () => {
  gameState = 'menu';
  rating.classList.remove('active');
  menu.classList.add('active');
};

btnRestart.onclick = () => {
  gameOverScreen.classList.remove('active');
  initGame();
};

btnMenu.onclick = () => {
  gameOverScreen.classList.remove('active');
  gameState = 'menu';
  menu.classList.add('active');
};

// --- Управление с клавиатуры ---
window.addEventListener('keydown', e => {
  if (gameState === 'playing') {
    if (e.code === 'ArrowLeft') player.vx = -5;
    else if (e.code === 'ArrowRight') player.vx = 5;
  }
});
window.addEventListener('keyup', e => {
  if (gameState === 'playing') {
    if (e.code === 'ArrowLeft' || e.code === 'ArrowRight') player.vx = 0;
  }
});

// --- Управление касанием ---
canvas.addEventListener('touchstart', e => {
  if (gameState === 'playing') {
    const touchX = e.touches[0].clientX;
    if (touchX < window.innerWidth / 2) player.vx = -5;
    else player.vx = 5;
  }
});
canvas.addEventListener('touchend', e => {
  if (gameState === 'playing') {
    player.vx = 0;
  }
});
</script>

</body>
</html>




